{"code":"_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[118],{\"+KI5\":function(e,t,r){\"use strict\";var n;r.d(t,\"a\",(function(){return n})),function(e){e[e.ACCEPTED=202]=\"ACCEPTED\",e[e.BAD_GATEWAY=502]=\"BAD_GATEWAY\",e[e.BAD_REQUEST=400]=\"BAD_REQUEST\",e[e.CONFLICT=409]=\"CONFLICT\",e[e.CONTINUE=100]=\"CONTINUE\",e[e.CREATED=201]=\"CREATED\",e[e.EXPECTATION_FAILED=417]=\"EXPECTATION_FAILED\",e[e.FAILED_DEPENDENCY=424]=\"FAILED_DEPENDENCY\",e[e.FORBIDDEN=403]=\"FORBIDDEN\",e[e.GATEWAY_TIMEOUT=504]=\"GATEWAY_TIMEOUT\",e[e.GONE=410]=\"GONE\",e[e.HTTP_VERSION_NOT_SUPPORTED=505]=\"HTTP_VERSION_NOT_SUPPORTED\",e[e.IM_A_TEAPOT=418]=\"IM_A_TEAPOT\",e[e.INSUFFICIENT_SPACE_ON_RESOURCE=419]=\"INSUFFICIENT_SPACE_ON_RESOURCE\",e[e.INSUFFICIENT_STORAGE=507]=\"INSUFFICIENT_STORAGE\",e[e.INTERNAL_SERVER_ERROR=500]=\"INTERNAL_SERVER_ERROR\",e[e.LENGTH_REQUIRED=411]=\"LENGTH_REQUIRED\",e[e.LOCKED=423]=\"LOCKED\",e[e.METHOD_FAILURE=420]=\"METHOD_FAILURE\",e[e.METHOD_NOT_ALLOWED=405]=\"METHOD_NOT_ALLOWED\",e[e.MOVED_PERMANENTLY=301]=\"MOVED_PERMANENTLY\",e[e.MOVED_TEMPORARILY=302]=\"MOVED_TEMPORARILY\",e[e.MULTI_STATUS=207]=\"MULTI_STATUS\",e[e.MULTIPLE_CHOICES=300]=\"MULTIPLE_CHOICES\",e[e.NETWORK_AUTHENTICATION_REQUIRED=511]=\"NETWORK_AUTHENTICATION_REQUIRED\",e[e.NO_CONTENT=204]=\"NO_CONTENT\",e[e.NON_AUTHORITATIVE_INFORMATION=203]=\"NON_AUTHORITATIVE_INFORMATION\",e[e.NOT_ACCEPTABLE=406]=\"NOT_ACCEPTABLE\",e[e.NOT_FOUND=404]=\"NOT_FOUND\",e[e.NOT_IMPLEMENTED=501]=\"NOT_IMPLEMENTED\",e[e.NOT_MODIFIED=304]=\"NOT_MODIFIED\",e[e.OK=200]=\"OK\",e[e.PARTIAL_CONTENT=206]=\"PARTIAL_CONTENT\",e[e.PAYMENT_REQUIRED=402]=\"PAYMENT_REQUIRED\",e[e.PERMANENT_REDIRECT=308]=\"PERMANENT_REDIRECT\",e[e.PRECONDITION_FAILED=412]=\"PRECONDITION_FAILED\",e[e.PRECONDITION_REQUIRED=428]=\"PRECONDITION_REQUIRED\",e[e.PROCESSING=102]=\"PROCESSING\",e[e.PROXY_AUTHENTICATION_REQUIRED=407]=\"PROXY_AUTHENTICATION_REQUIRED\",e[e.REQUEST_HEADER_FIELDS_TOO_LARGE=431]=\"REQUEST_HEADER_FIELDS_TOO_LARGE\",e[e.REQUEST_TIMEOUT=408]=\"REQUEST_TIMEOUT\",e[e.REQUEST_TOO_LONG=413]=\"REQUEST_TOO_LONG\",e[e.REQUEST_URI_TOO_LONG=414]=\"REQUEST_URI_TOO_LONG\",e[e.REQUESTED_RANGE_NOT_SATISFIABLE=416]=\"REQUESTED_RANGE_NOT_SATISFIABLE\",e[e.RESET_CONTENT=205]=\"RESET_CONTENT\",e[e.SEE_OTHER=303]=\"SEE_OTHER\",e[e.SERVICE_UNAVAILABLE=503]=\"SERVICE_UNAVAILABLE\",e[e.SWITCHING_PROTOCOLS=101]=\"SWITCHING_PROTOCOLS\",e[e.TEMPORARY_REDIRECT=307]=\"TEMPORARY_REDIRECT\",e[e.TOO_MANY_REQUESTS=429]=\"TOO_MANY_REQUESTS\",e[e.UNAUTHORIZED=401]=\"UNAUTHORIZED\",e[e.UNAVAILABLE_FOR_LEGAL_REASONS=451]=\"UNAVAILABLE_FOR_LEGAL_REASONS\",e[e.UNPROCESSABLE_ENTITY=422]=\"UNPROCESSABLE_ENTITY\",e[e.UNSUPPORTED_MEDIA_TYPE=415]=\"UNSUPPORTED_MEDIA_TYPE\",e[e.USE_PROXY=305]=\"USE_PROXY\"}(n||(n={}))},\"/kpp\":function(e,t,r){\"use strict\";var n=r(\"rePB\"),a=r(\"wx14\"),o=r(\"U8pU\"),i=r(\"q1tI\"),s=r(\"TSYQ\"),c=r.n(s),u=r(\"o/2+\"),l=r(\"H84U\"),d=r(\"R3zJ\"),f=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&\"function\"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};var p=[\"xs\",\"sm\",\"md\",\"lg\",\"xl\",\"xxl\"],O=i.forwardRef((function(e,t){var r,s=i.useContext(l.b),O=s.getPrefixCls,E=s.direction,b=i.useContext(u.a),h=b.gutter,m=b.wrap,v=e.prefixCls,T=e.span,I=e.order,R=e.offset,_=e.push,N=e.pull,y=e.className,A=e.children,S=e.flex,C=e.style,j=f(e,[\"prefixCls\",\"span\",\"order\",\"offset\",\"push\",\"pull\",\"className\",\"children\",\"flex\",\"style\"]),g=O(\"col\",v),k={};p.forEach((function(t){var r,i={},s=e[t];\"number\"===typeof s?i.span=s:\"object\"===Object(o.a)(s)&&(i=s||{}),delete j[t],k=Object(a.a)(Object(a.a)({},k),(r={},Object(n.a)(r,\"\".concat(g,\"-\").concat(t,\"-\").concat(i.span),void 0!==i.span),Object(n.a)(r,\"\".concat(g,\"-\").concat(t,\"-order-\").concat(i.order),i.order||0===i.order),Object(n.a)(r,\"\".concat(g,\"-\").concat(t,\"-offset-\").concat(i.offset),i.offset||0===i.offset),Object(n.a)(r,\"\".concat(g,\"-\").concat(t,\"-push-\").concat(i.push),i.push||0===i.push),Object(n.a)(r,\"\".concat(g,\"-\").concat(t,\"-pull-\").concat(i.pull),i.pull||0===i.pull),Object(n.a)(r,\"\".concat(g,\"-rtl\"),\"rtl\"===E),r))}));var P=c()(g,(r={},Object(n.a)(r,\"\".concat(g,\"-\").concat(T),void 0!==T),Object(n.a)(r,\"\".concat(g,\"-order-\").concat(I),I),Object(n.a)(r,\"\".concat(g,\"-offset-\").concat(R),R),Object(n.a)(r,\"\".concat(g,\"-push-\").concat(_),_),Object(n.a)(r,\"\".concat(g,\"-pull-\").concat(N),N),r),y,k),x={};if(h&&h[0]>0){var U=h[0]/2;x.paddingLeft=U,x.paddingRight=U}if(h&&h[1]>0&&!Object(d.b)()){var D=h[1]/2;x.paddingTop=D,x.paddingBottom=D}return S&&(x.flex=function(e){return\"number\"===typeof e?\"\".concat(e,\" \").concat(e,\" auto\"):/^\\d+(\\.\\d+)?(px|em|rem|%)$/.test(e)?\"0 0 \".concat(e):e}(S),\"auto\"!==S||!1!==m||x.minWidth||(x.minWidth=0)),i.createElement(\"div\",Object(a.a)({},j,{style:Object(a.a)(Object(a.a)({},x),C),className:P,ref:t}),A)}));O.displayName=\"Col\",t.a=O},\"2B9q\":function(e,t,r){var n=r(\"oTAN\"),a=r(\"2Uxx\"),o=r(\"pr3w\"),i=n?n.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?\"[object Undefined]\":\"[object Null]\":i&&i in Object(e)?a(e):o(e)}},\"2Uxx\":function(e,t,r){var n=r(\"oTAN\"),a=Object.prototype,o=a.hasOwnProperty,i=a.toString,s=n?n.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),r=e[s];try{e[s]=void 0;var n=!0}catch(c){}var a=i.call(e);return n&&(t?e[s]=r:delete e[s]),a}},\"5OYt\":function(e,t,r){\"use strict\";var n=r(\"ODXe\"),a=r(\"q1tI\"),o=r(\"ACnJ\");t.a=function(){var e=Object(a.useState)({}),t=Object(n.a)(e,2),r=t[0],i=t[1];return Object(a.useEffect)((function(){var e=o.a.subscribe((function(e){i(e)}));return function(){return o.a.unsubscribe(e)}}),[]),r}},\"94bU\":function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&(\"object\"==t||\"function\"==t)}},\"9ONQ\":function(e,t,r){\"use strict\";r.r(t);var n=r(\"iVi/\");function a(e,t){void 0===t&&(t={});var r=function(e){if(e&&\"j\"===e[0]&&\":\"===e[1])return e.substr(2);return e}(e);if(function(e,t){return\"undefined\"===typeof t&&(t=!e||\"{\"!==e[0]&&\"[\"!==e[0]&&'\"'!==e[0]),!t}(r,t.doNotParse))try{return JSON.parse(r)}catch(n){}return e}var o=r(\"Qetd\"),i=function(){function e(e,t){var r=this;this.changeListeners=[],this.HAS_DOCUMENT_COOKIE=!1,this.cookies=function(e,t){return\"string\"===typeof e?n.parse(e,t):\"object\"===typeof e&&null!==e?e:{}}(e,t),new Promise((function(){r.HAS_DOCUMENT_COOKIE=\"object\"===typeof document&&\"string\"===typeof document.cookie})).catch((function(){}))}return e.prototype._updateBrowserValues=function(e){this.HAS_DOCUMENT_COOKIE&&(this.cookies=n.parse(document.cookie,e))},e.prototype._emitChange=function(e){for(var t=0;t<this.changeListeners.length;++t)this.changeListeners[t](e)},e.prototype.get=function(e,t,r){return void 0===t&&(t={}),this._updateBrowserValues(r),a(this.cookies[e],t)},e.prototype.getAll=function(e,t){void 0===e&&(e={}),this._updateBrowserValues(t);var r={};for(var n in this.cookies)r[n]=a(this.cookies[n],e);return r},e.prototype.set=function(e,t,r){var a;\"object\"===typeof t&&(t=JSON.stringify(t)),this.cookies=o({},this.cookies,((a={})[e]=t,a)),this.HAS_DOCUMENT_COOKIE&&(document.cookie=n.serialize(e,t,r)),this._emitChange({name:e,value:t,options:r})},e.prototype.remove=function(e,t){var r=t=o({},t,{expires:new Date(1970,1,1,0,0,1),maxAge:0});this.cookies=o({},this.cookies),delete this.cookies[e],this.HAS_DOCUMENT_COOKIE&&(document.cookie=n.serialize(e,\"\",r)),this._emitChange({name:e,value:void 0,options:t})},e.prototype.addChangeListener=function(e){this.changeListeners.push(e)},e.prototype.removeChangeListener=function(e){var t=this.changeListeners.indexOf(e);t>=0&&this.changeListeners.splice(t,1)},e}();t.default=i},Axke:function(e,t,r){var n=r(\"g2lO\"),a=\"object\"==typeof self&&self&&self.Object===Object&&self,o=n||a||Function(\"return this\")();e.exports=o},CEi5:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push([\"/stream/webrtc/groupchat\",function(){return r(\"lCOc\")}])},HtUl:function(e,t){e.exports=function(e){return null!=e&&\"object\"==typeof e}},Ma5Y:function(e,t,r){var n=r(\"9ONQ\");n=n.default||n,e.exports=function(e,t){var r=e.req&&e.req.headers&&e.req.headers.cookie;return new n(r).getAll(t)}},R3zJ:function(e,t,r){\"use strict\";r.d(t,\"a\",(function(){return o})),r.d(t,\"b\",(function(){return i}));var n,a=r(\"MNnm\"),o=function(){return Object(a.a)()&&window.document.documentElement},i=function(){if(!o())return!1;if(void 0!==n)return n;var e=document.createElement(\"div\");return e.style.display=\"flex\",e.style.flexDirection=\"column\",e.style.rowGap=\"1px\",e.appendChild(document.createElement(\"div\")),e.appendChild(document.createElement(\"div\")),document.body.appendChild(e),n=1===e.scrollHeight,document.body.removeChild(e),n}},avRv:function(e,t,r){\"use strict\";var n=r(\"o0o1\"),a=r.n(n),o=r(\"HaE+\"),i=r(\"1OyB\"),s=r(\"vuIU\"),c=r(\"JX7q\"),u=r(\"Ji7U\"),l=r(\"md7G\"),d=r(\"foSv\"),f=r(\"rePB\"),p=r(\"CLrh\"),O=r(\"nOHt\"),E=r.n(O),b=r(\"TSYQ\"),h=r.n(b),m=r(\"q1tI\"),v=r.n(m),T=r(\"HQdG\"),I=r(\"MoJi\"),R=r(\"AY7M\"),_=v.a.createElement;function N(e){var t=function(){if(\"undefined\"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(d.a)(e);if(t){var a=Object(d.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(l.a)(this,r)}}var y=function(e){Object(u.a)(r,e);var t=N(r);function r(e){var n;return Object(i.a)(this,r),n=t.call(this,e),Object(f.a)(Object(c.a)(n),\"socket\",void 0),Object(f.a)(Object(c.a)(n),\"onbeforeunload\",(function(){var e=n.props,t=e.publish_started,r=e.webRTCAdaptor,a=n.state,o=a.conversationId,i=a.streamId;t&&(r&&r.leaveFromRoom(o),n.socket.emit(\"private-stream/leave\",{conversationId:o,streamId:i}))})),n.state={conversationId:\"\"},n}return Object(s.a)(r,[{key:\"componentDidMount\",value:function(){var e=this.props,t=e.id,r=e.containerClassName;this.socket=this.context,E.a.events.on(\"routeChangeStart\",this.onbeforeunload),window.addEventListener(\"beforeunload\",this.onbeforeunload);var n=document.getElementById(t),a=document.getElementsByClassName(r)[0];n.width=a.clientWidth/4}},{key:\"componentWillUnmount\",value:function(){window.removeEventListener(\"beforeunload\",this.onbeforeunload),E.a.events.off(\"routeChangeStart\",this.onbeforeunload)}},{key:\"handler\",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var r,n,o,i,s,c,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,n=r.webRTCAdaptor,o=r.settings,i=this.state,s=i.conversationId,c=i.streamId,t!==I.a.INITIALIZED){e.next=6;break}n.joinRoom(s,c),e.next=14;break;case 6:if(t!==I.a.JOINED_THE_ROOM){e.next=13;break}return e.next=9,p.p.getPublishToken({streamId:c,settings:o});case 9:u=e.sent,n.publish(c,u),e.next=14;break;case 13:\"publish_started\"===t?this.socket.emit(\"private-stream/join\",{conversationId:s,streamId:c}):\"publish_finished\"===t&&this.socket.emit(\"private-stream/leave\",{conversationId:s,streamId:c});case 14:case\"end\":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:\"start\",value:function(e){this.setState({conversationId:e})}},{key:\"publish\",value:function(e){var t=this.props.initWebRTCAdaptor;this.setState({streamId:e}),t(this.handler.bind(this))}},{key:\"stop\",value:function(){(0,this.props.leaveSession)()}},{key:\"render\",value:function(){var e=this.props,t=e.publish_started,r=e.id,n=e.classNames;return _(\"video\",{id:r,className:h()(\"video-js\",n),hidden:!t,autoPlay:!0,playsInline:!0,muted:!0})}}]),r}(m.PureComponent);y.contextType=R.c,t.a=Object(T.a)(y)},g2lO:function(e,t,r){(function(t){var r=\"object\"==typeof t&&t&&t.Object===Object&&t;e.exports=r}).call(this,r(\"yLpj\"))},\"iVi/\":function(e,t,r){\"use strict\";t.parse=function(e,t){if(\"string\"!==typeof e)throw new TypeError(\"argument str must be a string\");for(var r={},a=t||{},i=e.split(o),c=a.decode||n,u=0;u<i.length;u++){var l=i[u],d=l.indexOf(\"=\");if(!(d<0)){var f=l.substr(0,d).trim(),p=l.substr(++d,l.length).trim();'\"'==p[0]&&(p=p.slice(1,-1)),void 0==r[f]&&(r[f]=s(p,c))}}return r},t.serialize=function(e,t,r){var n=r||{},o=n.encode||a;if(\"function\"!==typeof o)throw new TypeError(\"option encode is invalid\");if(!i.test(e))throw new TypeError(\"argument name is invalid\");var s=o(t);if(s&&!i.test(s))throw new TypeError(\"argument val is invalid\");var c=e+\"=\"+s;if(null!=n.maxAge){var u=n.maxAge-0;if(isNaN(u))throw new Error(\"maxAge should be a Number\");c+=\"; Max-Age=\"+Math.floor(u)}if(n.domain){if(!i.test(n.domain))throw new TypeError(\"option domain is invalid\");c+=\"; Domain=\"+n.domain}if(n.path){if(!i.test(n.path))throw new TypeError(\"option path is invalid\");c+=\"; Path=\"+n.path}if(n.expires){if(\"function\"!==typeof n.expires.toUTCString)throw new TypeError(\"option expires is invalid\");c+=\"; Expires=\"+n.expires.toUTCString()}n.httpOnly&&(c+=\"; HttpOnly\");n.secure&&(c+=\"; Secure\");if(n.sameSite){switch(\"string\"===typeof n.sameSite?n.sameSite.toLowerCase():n.sameSite){case!0:c+=\"; SameSite=Strict\";break;case\"lax\":c+=\"; SameSite=Lax\";break;case\"strict\":c+=\"; SameSite=Strict\";break;case\"none\":c+=\"; SameSite=None\";break;default:throw new TypeError(\"option sameSite is invalid\")}}return c};var n=decodeURIComponent,a=encodeURIComponent,o=/; */,i=/^[\\u0009\\u0020-\\u007e\\u0080-\\u00ff]+$/;function s(e,t){try{return t(e)}catch(r){return e}}},lCOc:function(e,t,r){\"use strict\";r.r(t);var n,a=r(\"wx14\"),o=r(\"o0o1\"),i=r.n(o),s=r(\"HaE+\"),c=r(\"1OyB\"),u=r(\"vuIU\"),l=r(\"JX7q\"),d=r(\"Ji7U\"),f=r(\"md7G\"),p=r(\"foSv\"),O=r(\"rePB\"),E=r(\"q1tI\"),b=r.n(E),h=r(\"8Kt/\"),m=r.n(h),v=r(\"VXEj\"),T=r(\"BMrR\"),I=r(\"kPKH\"),R=r(\"tsqr\"),_=r(\"2/Rp\"),N=r(\"nOHt\"),y=r.n(N),A=r(\"CLrh\"),S=r(\"/MKj\"),C=r(\"gxiY\"),j=r(\"x7is\"),g=r(\"AY7M\"),k=r(\"Ma5Y\"),P=r.n(k),x=r(\"L/eJ\"),U=r(\"NsEo\"),D=r(\"avRv\"),w=r(\"nL36\"),L=r(\"+KI5\"),M=b.a.createElement;function H(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?H(Object(r),!0).forEach((function(t){Object(O.a)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):H(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function V(e){var t=function(){if(\"undefined\"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(p.a)(e);if(t){var a=Object(p.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(f.a)(this,r)}}!function(e){e.JOINED_THE_ROOM=\"JOINED_THE_ROOM\",e.JOIN_ROOM=\"JOIN_ROOM\",e.LEAVE_ROOM=\"LEAVE_ROOM\",e.STREAM_INFORMATION_CHANGED=\"private-stream/streamInformationChanged\",e.MODEL_JOIN_ROOM=\"MODEL_JOIN_ROOM\",e.SEND_PAID_TOKEN=\"SEND_PAID_TOKEN\"}(n||(n={}));var B=function(e){var t=e.description,r=e.title;return M(v.b.Item,null,M(T.a,{style:{width:\"100%\"}},M(I.a,{className:\"light-text\",sm:{span:6},xs:{span:12}},r),M(I.a,{style:{fontWeight:\"bold\"},sm:{span:18},xs:{span:12}},t)))},G=function(e){Object(d.a)(r,e);var t=V(r);function r(e){var n;return Object(c.a)(this,r),n=t.call(this,e),Object(O.a)(Object(l.a)(n),\"localVideoId\",\"group-publisher\"),Object(O.a)(Object(l.a)(n),\"remoteVideoContainerClassname\",\"group-video-container\"),Object(O.a)(Object(l.a)(n),\"mainVideoRef\",void 0),Object(O.a)(Object(l.a)(n),\"publisherRef\",void 0),Object(O.a)(Object(l.a)(n),\"subscriberRef\",void 0),Object(O.a)(Object(l.a)(n),\"interval\",void 0),Object(O.a)(Object(l.a)(n),\"socket\",void 0),Object(O.a)(Object(l.a)(n),\"onbeforeunload\",(function(){n.leaveSession()})),n.state={processing:!1,roomJoined:!1,total:0,callTime:0,paidToken:0,members:[],streamId:\"\",streamList:[]},n}return Object(u.a)(r,[{key:\"componentDidMount\",value:function(){this.publisherRef=b.a.createRef(),this.subscriberRef=b.a.createRef(),this.mainVideoRef=b.a.createRef(),this.socket=this.context,window.addEventListener(\"beforeunload\",this.onbeforeunload),y.a.events.on(\"routeChangeStart\",this.onbeforeunload)}},{key:\"componentDidUpdate\",value:function(e){var t,r=this.props.activeConversation;null!==r&&void 0!==r&&null!==(t=r.data)&&void 0!==t&&t._id&&r!==e.activeConversation&&this.initSocketEvent()}},{key:\"componentWillUnmount\",value:function(){window.removeEventListener(\"beforeunload\",this.onbeforeunload),y.a.events.off(\"routeChangeStart\",this.onbeforeunload)}},{key:\"handler\",value:function(e){var t,r=e.total,n=e.members,a=e.conversationId,o=this.props.activeConversation;null!==o&&void 0!==o&&null!==(t=o.data)&&void 0!==t&&t._id&&a===o.data._id&&this.setState({total:r,members:n})}},{key:\"handleRemoteVideo\",value:function(e){var t=e.target.srcObject;this.mainVideoRef.current.srcObject=t,this.mainVideoRef.current.hidden=!1,this.mainVideoRef.current.play()}},{key:\"leaveSession\",value:function(){var e=this.props,t=e.activeConversation;(0,e.resetStreamMessage)(),this.socket&&t&&t.data&&(this.socket.off(\"JOINED_THE_ROOM\"),this.socket.off(\"private-stream/streamJoined\"),this.socket.off(\"private-stream/streamLeaved\"),this.socket.emit(n.LEAVE_ROOM,{conversationId:t.data._id})),this.interval&&clearInterval(this.interval),this.setState({processing:!1,roomJoined:!1,total:0,members:[]})}},{key:\"joinGroupChat\",value:function(){var e=Object(s.a)(i.a.mark((function e(){var t,r,a,o,s,c,u,l,d;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props,r=t.performer,a=t.getStreamConversationSuccess,o=t.loadMoreStreamMessages,e.prev=1,this.setState({processing:!0}),e.next=5,A.p.joinGroupChat(r._id);case 5:(s=e.sent)&&s.data&&(this.socket=this.context,c=s.data,u=c.sessionId,l=c.conversation,this.publisherRef.current&&this.publisherRef.current.start(l._id,u),a({data:l}),o({conversationId:l._id,limit:25,offset:0,type:l.type}),R.b.success(\"Success\"),this.socket.emit(n.JOIN_ROOM,{conversationId:l._id})),e.next=15;break;case 9:return e.prev=9,e.t0=e.catch(1),e.next=13,Promise.resolve(e.t0);case 13:d=e.sent,R.b.error(Object(U.g)(d));case 15:return e.prev=15,this.setState({processing:!1}),e.finish(15);case 18:case\"end\":return e.stop()}}),e,this,[[1,9,15,18]])})));return function(){return e.apply(this,arguments)}}()},{key:\"roomJoinedHandler\",value:function(e){var t,r=this,n=e.total,a=e.members,o=e.conversationId,i=this.props,s=i.activeConversation,c=i.performer,u=i.user;null!==s&&void 0!==s&&null!==(t=s.data)&&void 0!==t&&t._id&&o===s.data._id&&(this.interval=setInterval((function(){var e=r.state.callTime;if(u.balance<c.groupCallPrice)return R.b.warn(\"Your balance is not enough token.\"),void setTimeout((function(){return window.location.reload()}),1e4);r.setState({callTime:e+1}),r.sendPaidToken(o)}),6e4),this.setState({total:n,members:a,roomJoined:!0,callTime:0}))}},{key:\"leave\",value:function(){this.publisherRef.current&&this.publisherRef.current.stop(),this.subscriberRef.current&&this.subscriberRef.current.stop(),setTimeout((function(){window.location.href=\"/\"}),1e4)}},{key:\"sendPaidToken\",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a,o,s;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r=this.props,n=r.performer,a=r.updateCurrentUserBalance,o=this.state.paidToken,e.next=5,A.r.sendPaidToken(t);case 5:s={paidToken:o+n.groupCallPrice},this.setState(s),a(-1*n.groupCallPrice),e.next=16;break;case 10:return e.prev=10,e.t0=e.catch(0),e.next=14,Promise.resolve(e.t0);case 14:400===e.sent.statusCode&&(R.b.error(\"Your tokens do not enough, please buy more.\"),clearInterval(this.interval),this.leave());case 16:case\"end\":return e.stop()}}),e,this,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:\"initSocketEvent\",value:function(){var e=this;this.socket=this.context,this.socket.on(\"JOINED_THE_ROOM\",(function(t){var r=t.streamId,n=t.streamList;t.conversationId===e.props.activeConversation.data._id&&(e.setState({streamId:r,streamList:n}),e.publisherRef.current&&e.publisherRef.current.publish(r),n.length&&e.subscriberRef.current&&e.subscriberRef.current.play(n))})),this.socket.on(\"private-stream/streamJoined\",(function(t){e.state.streamId!==t.streamId&&e.subscriberRef.current&&e.subscriberRef.current.play([t.streamId])})),this.socket.on(\"private-stream/streamLeaved\",(function(t){var r=e.state,n=r.streamList,a=r.streamId;e.setState({streamList:n.filter((function(e){return e!==t.streamId}))}),a!==t.streamId&&e.subscriberRef.current&&e.subscriberRef.current.close(t.streamId)}))}},{key:\"render\",value:function(){var e=this.props.performer,t=this.state,r=t.processing,o=t.total,i=t.members,s=t.roomJoined,c=t.callTime,u=t.paidToken,l=[{title:\"Call time\",description:\"\".concat(c,\" minute(s)\")},{title:\"Status\",description:s?\"Live\":\"\"},{title:\"Paid Token\",description:\"\".concat(u,\" token(s)\")},{title:\"Token per minute\",description:\"\".concat(e.groupCallPrice,\" token(s)\")||!1}];return M(b.a.Fragment,null,M(m.a,null,M(\"title\",null,\"Group Chat\")),M(g.a,{event:n.STREAM_INFORMATION_CHANGED,handler:this.handler.bind(this)}),M(g.a,{event:n.JOINED_THE_ROOM,handler:this.roomJoinedHandler.bind(this)}),M(\"div\",{className:\"container\"},M(T.a,null,M(I.a,{md:12,xs:24},s?M(_.a,{type:\"primary\",onClick:this.leave.bind(this),block:!0,disabled:r},\"Stop Streaming\"):M(_.a,{type:\"primary\",onClick:this.joinGroupChat.bind(this),loading:r,block:!0},\"Join Conversation\"),M(\"div\",{style:{display:\"flex\",justifyContent:\"center\"}},M(\"video\",{id:\"subscriber\",ref:this.mainVideoRef,hidden:!0,controls:!0})),M(T.a,{className:this.remoteVideoContainerClassname},M(D.a,Object(a.a)({},this.props,{id:this.localVideoId,ref:this.publisherRef,classNames:\"ant-col ant-col-6\",containerClassName:this.remoteVideoContainerClassname,configs:{localVideoId:this.localVideoId}})),M(w.a,Object(a.a)({},this.props,{ref:this.subscriberRef,classNames:\"ant-col ant-col-6\",onClick:this.handleRemoteVideo.bind(this),containerClassName:this.remoteVideoContainerClassname,configs:{isPlayMode:!0}}))),M(v.b,{dataSource:l,renderItem:function(e){return M(B,{description:e.description,title:e.title})}})),M(I.a,{xs:24,md:12},M(x.a,Object(a.a)({},this.props,{totalParticipant:o,members:i}))))))}}],[{key:\"getInitialProps\",value:function(){var e=Object(s.a)(i.a.mark((function e(t){var r,n,a,o,s,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.ctx,e.prev=1,!(n=r.query).performer){e.next=5;break}return e.abrupt(\"return\",{performer:JSON.parse(n.performer)});case 5:return a=P()(r),o=a.token,s={Authorization:o},e.next=9,A.j.details(n.username,s);case 9:if(c=e.sent,!(u=c.data).isBlocked){e.next=13;break}throw L.a.FORBIDDEN;case 13:return e.abrupt(\"return\",{performer:u});case 16:return e.prev=16,e.t0=e.catch(1),e.abrupt(\"return\",y.a.push(\"/\"));case 20:return r.res.writeHead&&r.res.writeHead(302,{Location:\"/\"}),r.res.end&&r.res.end(),e.abrupt(\"return\",{});case 23:case\"end\":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}()}]),r}(E.PureComponent);Object(O.a)(G,\"authenticate\",!0),G.contextType=g.c;var Y={getStreamConversationSuccess:C.e,loadMoreStreamMessages:C.f,resetStreamMessage:C.l,updateCurrentUserBalance:j.o};t.default=Object(S.b)((function(e){return F(F({},e.streaming),{},{ui:e.ui,user:e.user.current,loggedIn:e.auth.loggedIn,activeConversation:e.streamMessage.activeConversation})}),Y)(Object(N.withRouter)(G))},nL36:function(e,t,r){\"use strict\";var n=r(\"KQm4\"),a=r(\"o0o1\"),o=r.n(a),i=r(\"HaE+\"),s=r(\"1OyB\"),c=r(\"vuIU\"),u=r(\"JX7q\"),l=r(\"Ji7U\"),d=r(\"md7G\"),f=r(\"foSv\"),p=r(\"rePB\"),O=r(\"q1tI\"),E=r(\"CLrh\"),b=r(\"TSYQ\"),h=r.n(b),m=r(\"HQdG\"),v=r(\"MoJi\"),T=O.createElement;function I(e){var t=function(){if(\"undefined\"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=Object(f.a)(e);if(t){var a=Object(f.a)(this).constructor;r=Reflect.construct(n,arguments,a)}else r=n.apply(this,arguments);return Object(d.a)(this,r)}}var R=function(e){Object(l.a)(r,e);var t=I(r);function r(){var e;Object(s.a)(this,r);for(var n=arguments.length,a=new Array(n),o=0;o<n;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),Object(p.a)(Object(u.a)(e),\"streamIds\",[]),Object(p.a)(Object(u.a)(e),\"availableStreamIds\",[]),e}return Object(c.a)(r,[{key:\"handler\",value:function(){var e=Object(i.a)(o.a.mark((function e(t,r){var n,a,i,s,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.props,a=n.webRTCAdaptor,i=n.settings,t!==v.a.INITIALIZED){e.next=14;break}if(!Array.isArray(this.streamIds)){e.next=8;break}return e.next=5,Promise.all(this.streamIds.map((function(e){return E.p.getSubscriberToken({streamId:e,settings:i})})));case 5:return s=e.sent,this.streamIds.map((function(e,t){return a.play(e,s[t])})),e.abrupt(\"return\");case 8:return e.next=10,E.p.getSubscriberToken({streamId:this.streamIds,settings:i});case 10:c=e.sent,a.play(this.streamIds,c),e.next=31;break;case 14:if(t!==v.a.NEW_STREAM_AVAILABLE){e.next=19;break}this.availableStreamIds.find((function(e){return e===r.streamId}))||(this.availableStreamIds.push(r.streamId),this.createRemoteVideo(r)),e.next=31;break;case 19:if(t!==v.a.PLAY_FINISHED){e.next=25;break}this.availableStreamIds=this.availableStreamIds.filter((function(e){return e!==r.streamId})),this.removeRemoteVideo(r.streamId),setTimeout((function(){a.getStreamInfo(r.streamId)}),3e3),e.next=31;break;case 25:if(t!==v.a.STREAM_INFORMATION){e.next=31;break}if(!this.streamIds.includes(r.streamId)){e.next=31;break}return e.next=29,E.p.getSubscriberToken({streamId:r.streamId,settings:i});case 29:u=e.sent,a.play(r.streamId,u);case 31:case\"end\":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:\"cbErrorHandler\",value:function(){var e=Object(i.a)(o.a.mark((function e(t){var r,n,a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:\"no_stream_exist\"===t&&(r=this.props,n=r.webRTCAdaptor,a=r.initWebRTCAdaptor,n?this.streamIds.forEach((function(e){return n.getStreamInfo(e)})):a(this.handler.bind(this),this.cbErrorHandler.bind(this)));case 1:case\"end\":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:\"createRemoteVideo\",value:function(e){var t=e.stream,r=e.streamId,n=this.props,a=n.classNames,o=n.containerClassName,i=n.onClick,s=document.createElement(\"video\"),c=document.getElementsByClassName(o)[0];s.setAttribute(\"id\",\"streamId-subscriber-\".concat(r)),s.setAttribute(\"class\",h()(\"video-js\",a)),s.autoplay=!0,s.muted=!0,s.controls=!0,s.playsInline=!0,s.width=c.clientWidth/4,s.srcObject=t,s.addEventListener(\"click\",i),c.append(s)}},{key:\"removeRemoteVideo\",value:function(e){var t=this.props.containerClassName,r=document.getElementById(\"streamId-subscriber-\".concat(e));r&&(r.srcObject=null,document.getElementsByClassName(t)[0].removeChild(r))}},{key:\"play\",value:function(){var e=Object(i.a)(o.a.mark((function e(t){var r,a,i,s,c,u;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=this.props,a=r.initWebRTCAdaptor,i=r.initialized,s=r.webRTCAdaptor,c=r.settings,this.streamIds=[].concat(Object(n.a)(this.streamIds),Object(n.a)(t)),!i){e.next=9;break}if(!Array.isArray(t)){e.next=8;break}return e.next=6,Promise.all(t.map((function(e){return E.p.getSubscriberToken({streamId:e,settings:c})})));case 6:u=e.sent,t.map((function(e,t){return s.play(e,u[t])}));case 8:return e.abrupt(\"return\");case 9:a(this.handler.bind(this),this.cbErrorHandler.bind(this));case 10:case\"end\":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:\"close\",value:function(e){this.streamIds=this.streamIds.filter((function(t){return t!==e}))}},{key:\"stop\",value:function(){(0,this.props.leaveSession)()}},{key:\"render\",value:function(){return T(O.Fragment,null)}}]),r}(O.PureComponent);t.a=Object(m.a)(R)},\"o/2+\":function(e,t,r){\"use strict\";var n=r(\"q1tI\"),a=Object(n.createContext)({});t.a=a},oTAN:function(e,t,r){var n=r(\"Axke\").Symbol;e.exports=n},pr3w:function(e,t){var r=Object.prototype.toString;e.exports=function(e){return r.call(e)}},qrJ5:function(e,t,r){\"use strict\";var n=r(\"wx14\"),a=r(\"rePB\"),o=r(\"U8pU\"),i=r(\"ODXe\"),s=r(\"q1tI\"),c=r(\"TSYQ\"),u=r.n(c),l=r(\"H84U\"),d=r(\"o/2+\"),f=r(\"CWQg\"),p=r(\"ACnJ\"),O=r(\"R3zJ\"),E=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&\"function\"===typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r},b=(Object(f.a)(\"top\",\"middle\",\"bottom\",\"stretch\"),Object(f.a)(\"start\",\"end\",\"center\",\"space-around\",\"space-between\"),s.forwardRef((function(e,t){var r,c=e.prefixCls,f=e.justify,b=e.align,h=e.className,m=e.style,v=e.children,T=e.gutter,I=void 0===T?0:T,R=e.wrap,_=E(e,[\"prefixCls\",\"justify\",\"align\",\"className\",\"style\",\"children\",\"gutter\",\"wrap\"]),N=s.useContext(l.b),y=N.getPrefixCls,A=N.direction,S=s.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),C=Object(i.a)(S,2),j=C[0],g=C[1],k=s.useRef(I);s.useEffect((function(){var e=p.a.subscribe((function(e){var t=k.current||0;(!Array.isArray(t)&&\"object\"===Object(o.a)(t)||Array.isArray(t)&&(\"object\"===Object(o.a)(t[0])||\"object\"===Object(o.a)(t[1])))&&g(e)}));return function(){return p.a.unsubscribe(e)}}),[]);var P=y(\"row\",c),x=function(){var e=[0,0];return(Array.isArray(I)?I:[I,0]).forEach((function(t,r){if(\"object\"===Object(o.a)(t))for(var n=0;n<p.b.length;n++){var a=p.b[n];if(j[a]&&void 0!==t[a]){e[r]=t[a];break}}else e[r]=t||0})),e}(),U=u()(P,(r={},Object(a.a)(r,\"\".concat(P,\"-no-wrap\"),!1===R),Object(a.a)(r,\"\".concat(P,\"-\").concat(f),f),Object(a.a)(r,\"\".concat(P,\"-\").concat(b),b),Object(a.a)(r,\"\".concat(P,\"-rtl\"),\"rtl\"===A),r),h),D={},w=x[0]>0?x[0]/-2:void 0,L=x[1]>0?x[1]/-2:void 0;if(D.marginLeft=w,D.marginRight=w,Object(O.b)()){var M=Object(i.a)(x,2);D.rowGap=M[1]}else D.marginTop=L,D.marginBottom=L;return s.createElement(d.a.Provider,{value:{gutter:x,wrap:R}},s.createElement(\"div\",Object(n.a)({},_,{className:U,style:Object(n.a)(Object(n.a)({},D),m),ref:t}),v))})));b.displayName=\"Row\",t.a=b},x7is:function(e,t,r){\"use strict\";r.d(t,\"m\",(function(){return a})),r.d(t,\"n\",(function(){return o})),r.d(t,\"o\",(function(){return i})),r.d(t,\"p\",(function(){return c})),r.d(t,\"r\",(function(){return u})),r.d(t,\"q\",(function(){return l})),r.d(t,\"l\",(function(){return d})),r.d(t,\"k\",(function(){return f})),r.d(t,\"a\",(function(){return p})),r.d(t,\"b\",(function(){return E})),r.d(t,\"d\",(function(){return b})),r.d(t,\"c\",(function(){return h})),r.d(t,\"i\",(function(){return m})),r.d(t,\"j\",(function(){return v})),r.d(t,\"e\",(function(){return I})),r.d(t,\"g\",(function(){return R})),r.d(t,\"f\",(function(){return _})),r.d(t,\"h\",(function(){return N}));var n=r(\"vo7w\"),a=Object(n.a)(\"updateCurrentUser\"),o=Object(n.a)(\"updateCurrentUserAvatar\"),i=Object(n.a)(\"updateCurrentUserBalance\"),s=Object(n.b)(\"updateUser\",\"UPDATE_USER\"),c=s.updateUser,u=s.updateUserSuccess,l=s.updateUserFail,d=Object(n.a)(\"updatingUser\"),f=Object(n.a)(\"setUserReducer\"),p=Object(n.a)(\"buyTokenSuccess\"),O=Object(n.b)(\"getFavoritePerformers\",\"GET_FAVOURITE\"),E=O.getFavoritePerformers,b=O.getFavoritePerformersSuccess,h=O.getFavoritePerformersFailed,m=Object(n.a)(\"GETTING_FAVORITE\"),v=Object(n.a)(\"REMOVE_FAVORITE\"),T=Object(n.b)(\"getPaymentTokenHistroy\",\"GET_PAYMET_TOKE_HISTORY\"),I=T.getPaymentTokenHistroy,R=T.getPaymentTokenHistroySuccess,_=T.getPaymentTokenHistroyFail,N=Object(n.a)(\"GETTING_PAYMET_TOKE_HISTORY\")}},[[\"CEi5\",0,1,4,5,3,2,6,7,8,10,11,12,13,14,15,16,17,20,22,23,25,26,29,30,37,9]]]);","extractedComments":[]}