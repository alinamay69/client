{"ast":null,"code":"var __jsx = React.createElement;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/* eslint-disable no-return-assign */\nimport React, { PureComponent } from 'react';\nimport { SettingOutlined, HeartOutlined, MessageOutlined, UserOutlined, LogoutOutlined, SearchOutlined, CloseOutlined, BellOutlined } from '@ant-design/icons';\nimport { FundsIcon } from '@components/common/base/icons';\nimport { Layout, Menu, Avatar, Input, Button, Dropdown, Badge, Card, message, Tooltip } from 'antd';\nimport { messageService } from 'src/services/index';\nimport { createSelector } from 'reselect';\nimport { connect } from 'react-redux';\nimport Link from 'next/link';\nimport Router, { withRouter } from 'next/router';\nimport { logout } from '@redux/auth/actions';\nimport { getPerformerCategories } from '@redux/performer/actions';\nimport { getCountries } from '@redux/settings/actions';\nimport { SocketContext } from 'src/socket';\nimport { addPrivateRequest } from '@redux/streaming/actions';\nimport dynamic from 'next/dynamic';\nimport { formatDate } from 'src/lib';\nimport { getStudioStats } from 'src/redux/studio/actions';\nimport SoundPlayer from 'src/components/common/base/sound';\nimport { countNotReadMessage } from '@redux/message/actions';\nimport NumberFormat from '@components/common/layout/numberformat';\nimport './header.less';\nimport { SETTING_KEYS } from 'src/constants';\nconst LeftHeaderContent = dynamic(() => import('./left-header-content'), {\n  ssr: false,\n  loadableGenerated: {\n    webpack: () => [require.resolveWeak('./left-header-content')],\n    modules: ['./left-header-content']\n  }\n});\n\nconst roundBalance = balance => {\n  if (balance < 10000) return Math.round(balance);\n  return '9999+';\n};\n\nconst EVENT = {\n  RECEIVED_PRIVATE_CHAT_REQUEST: 'private-chat-request',\n  NOTIFY_READ_MESSAGE: 'nofify_read_messages_in_conversation',\n  TIPPED: 'tipped'\n};\n\nclass Header extends PureComponent {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"soundRef\", void 0);\n\n    _defineProperty(this, \"socket\", void 0);\n\n    _defineProperty(this, \"handleMessage\", event => {\n      const {\n        countNotReadMessage: dispatchCountNotReadMessage\n      } = this.props;\n      event && dispatchCountNotReadMessage(event.total);\n    });\n\n    _defineProperty(this, \"handlePrivateChat\", data => {\n      const {\n        addPrivateRequest: dispatchAddPrivateRequest,\n        settings\n      } = this.props;\n      const path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n      message.success({\n        content: __jsx(\"span\", null, data.user.username, ' ', \"sent you a private chat request.\"),\n        duration: 10,\n        key: data.conversationId,\n        onClick: () => Router.push({\n          pathname: `/live/${path}privatechat`,\n          query: {\n            id: data.conversationId\n          }\n        }, `/live/${path}privatechat/${data.conversationId}`)\n      });\n      this.soundRef && this.soundRef.play();\n      dispatchAddPrivateRequest(_objectSpread(_objectSpread({}, data), {}, {\n        createdAt: new Date()\n      }));\n    });\n\n    _defineProperty(this, \"sendTipHandler\", ({\n      token,\n      senderInfo\n    }) => {\n      message.success(`${senderInfo.username} tip ${token === null || token === void 0 ? void 0 : token.toFixed(2)} tokens`, 10);\n      this.soundRef && this.soundRef.play();\n    });\n\n    _defineProperty(this, \"initSocketEvent\", () => {\n      this.socket = this.context;\n      const {\n        currentUser\n      } = this.props;\n\n      if (this.socket.connected) {\n        if (currentUser.role === 'performer') {\n          this.socket.on(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST, this.handlePrivateChat);\n          this.socket.on(EVENT.TIPPED, this.sendTipHandler);\n        }\n\n        this.socket.on(EVENT.NOTIFY_READ_MESSAGE, this.handleMessage);\n      } else {\n        this.socket.on('connect', () => {\n          if (currentUser.role === 'performer') {\n            this.socket.on(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST, this.handlePrivateChat);\n            this.socket.on(EVENT.TIPPED, this.sendTipHandler);\n          }\n\n          this.socket.on(EVENT.NOTIFY_READ_MESSAGE, this.handleMessage);\n        });\n      }\n    });\n\n    this.state = {\n      showSearch: false\n    };\n  }\n\n  async componentDidMount() {\n    const {\n      getPerformerCategories: dispatchGetPerformerCategories,\n      getCountries: dispatchGetCountries,\n      getStudioStats: dispatchGetStudioStats,\n      currentUser,\n      loggedIn,\n      countNotReadMessage: dispatchCountNotReadMessage\n    } = this.props; // this.socket = this.context;\n\n    dispatchGetPerformerCategories({\n      limit: 0\n    });\n    dispatchGetCountries();\n\n    if (currentUser !== null && currentUser !== void 0 && currentUser._id) {\n      const data = await (await messageService.countTotalNotRead()).data;\n\n      if (data) {\n        dispatchCountNotReadMessage(data.total);\n      }\n    }\n\n    if (currentUser !== null && currentUser !== void 0 && currentUser._id && currentUser.role === 'studio') {\n      dispatchGetStudioStats();\n    }\n\n    if (loggedIn) {\n      this.initSocketEvent();\n      this.checkPermissionAccess();\n    }\n  }\n\n  componentDidUpdate(prevProps) {\n    const {\n      loggedIn,\n      router: {\n        query: {\n          unauthorized\n        }\n      }\n    } = this.props;\n\n    if (loggedIn && prevProps.loggedIn !== loggedIn) {\n      setTimeout(this.initSocketEvent, 1000);\n    }\n\n    if (unauthorized !== prevProps.router.query.unauthorized) {\n      this.checkPermissionAccess();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.socket) {\n      this.socket.off(EVENT.NOTIFY_READ_MESSAGE);\n      this.socket.off(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST);\n      this.socket.off(EVENT.TIPPED);\n    }\n  }\n\n  onSearchPerformer(key) {\n    this.search(key);\n  }\n\n  onPressEnter(event) {\n    const target = event.currentTarget;\n    const key = target.value;\n    this.search(key);\n  }\n\n  search(key) {\n    Router.push({\n      pathname: '/cams',\n      query: {\n        q: key\n      }\n    }, `/cams?q=${key}`);\n  }\n\n  async checkPermissionAccess() {\n    const {\n      loggedIn,\n      router: {\n        query: {\n          unauthorized\n        }\n      }\n    } = this.props;\n\n    if (!loggedIn || !unauthorized) {\n      return;\n    }\n\n    this.beforeLogout();\n  }\n\n  async beforeLogout() {\n    const {\n      logout: dispatchLogout\n    } = this.props;\n    dispatchLogout();\n    Router.replace('/');\n  }\n\n  render() {\n    const {\n      ui,\n      loggedIn,\n      privateRequests,\n      currentUser,\n      tipSound,\n      totalNotReadMessage,\n      settings\n    } = this.props;\n    const {\n      showSearch\n    } = this.state;\n    const path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n    const rightContent = loggedIn ? __jsx(React.Fragment, null, __jsx(Link, {\n      href: loggedIn && currentUser.role === 'user' ? '/account/user/funds-tokens' : '#'\n    }, __jsx(Tooltip, {\n      title: `${currentUser.balance && currentUser.balance.toFixed(2) || 0} Tokens`\n    }, __jsx(Button, {\n      style: {\n        margin: '0px 10px',\n        color: '#ff0066'\n      },\n      className: \"btn-tokens\"\n    }, `${roundBalance((currentUser === null || currentUser === void 0 ? void 0 : currentUser.balance) || 0)} Tokens`))), currentUser.role === 'performer' && __jsx(Dropdown, {\n      overlay: __jsx(Menu, null, privateRequests.length > 0 ? privateRequests.map(request => {\n        var _request$user, _request$user2, _request$user3;\n\n        return __jsx(Menu.Item, {\n          onClick: () => message.destroy(request.conversationId)\n        }, __jsx(Link, {\n          href: {\n            pathname: `/live/${path}privatechat`,\n            query: {\n              id: request.conversationId,\n              streamId: request.id\n            }\n          },\n          as: `/live/${path}privatechat/${request.conversationId}?streamId=${request.id}`,\n          key: request.conversationId\n        }, __jsx(\"a\", null, __jsx(Card, {\n          bordered: false,\n          hoverable: false\n        }, __jsx(Card.Meta, {\n          avatar: __jsx(Avatar, {\n            src: ((_request$user = request.user) === null || _request$user === void 0 ? void 0 : _request$user.avatar) || '/default-user-icon.png'\n          }),\n          title: __jsx(React.Fragment, null, __jsx(\"span\", null, (_request$user2 = request.user) === null || _request$user2 === void 0 ? void 0 : _request$user2.username), ' ', \"(\", __jsx(NumberFormat, {\n            value: ((_request$user3 = request.user) === null || _request$user3 === void 0 ? void 0 : _request$user3.balance) || 0,\n            suffix: \" tokens\"\n          }), \")\"),\n          description: formatDate(request === null || request === void 0 ? void 0 : request.createdAt)\n        })))));\n      }) : __jsx(Menu.Item, null, \"There are no private request.\"))\n    }, __jsx(\"span\", {\n      className: \"call-requests\"\n    }, __jsx(Badge, {\n      count: privateRequests.length,\n      showZero: true\n    }, __jsx(BellOutlined, {\n      style: {\n        color: '#ffffff'\n      }\n    })))), __jsx(Dropdown, {\n      overlay: __jsx(Menu, {\n        key: \"menu-right-content\"\n      }, currentUser.role === 'user' && [__jsx(Menu.Item, {\n        key: \"settings-menu-right-content\",\n        onClick: () => Router.push('/account/user/account-settings')\n      }, __jsx(\"span\", null, __jsx(SettingOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"Profile\")), __jsx(Menu.Item, {\n        key: \"favorite-menu-right-content\",\n        onClick: () => Router.push('/account/user/favorites')\n      }, __jsx(\"span\", null, __jsx(HeartOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"My Favorites\")), __jsx(Menu.Item, {\n        key: \"funds-tokens-menu-right-content\",\n        onClick: () => Router.push('/account/user/funds-tokens')\n      }, __jsx(\"span\", null, __jsx(\"span\", {\n        className: \"anticon primary-icon\"\n      }, __jsx(FundsIcon, null)), ' ', \"Funds / Tokens\")), __jsx(Menu.Item, {\n        key: \"user-messages-menu-right-content\",\n        onClick: () => Router.push('/messages')\n      }, __jsx(\"span\", null, __jsx(MessageOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"Messages (\", totalNotReadMessage || 0, \")\"))], currentUser.role === 'performer' && [__jsx(Menu.Item, {\n        key: \"profile-menu-right-content\",\n        onClick: () => Router.push('/account/performer/profile')\n      }, __jsx(\"span\", null, __jsx(UserOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"Profile\")), __jsx(Menu.Item, {\n        key: \"account-settings-menu-right-content\",\n        onClick: () => Router.push('/account/performer/account-settings')\n      }, __jsx(\"span\", null, __jsx(SettingOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"Account Settings\")), __jsx(Menu.Item, {\n        key: \"model-messages-menu-right-content\",\n        onClick: () => Router.push('/messages')\n      }, __jsx(\"span\", null, __jsx(MessageOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"Messages (\", totalNotReadMessage, \")\"))], currentUser.role === 'studio' && [__jsx(Menu.Item, {\n        key: \"account-settings-menu-right-content\",\n        onClick: () => Router.push('/studio/account-settings')\n      }, __jsx(\"span\", null, __jsx(SettingOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"Account Settings\"))], __jsx(Menu.Item, {\n        key: \"log-out\",\n        onClick: this.beforeLogout.bind(this)\n      }, __jsx(LogoutOutlined, {\n        className: \"primary-icon\"\n      }), ' ', \"Log out\"))\n    }, __jsx(Avatar, {\n      style: {\n        margin: '0 15px',\n        cursor: 'pointer',\n        background: '#ffffff'\n      },\n      src: (currentUser === null || currentUser === void 0 ? void 0 : currentUser.avatar) || '/default-user-icon.png'\n    }))) : __jsx(Button, {\n      style: {\n        marginLeft: 20,\n        marginRight: 10,\n        color: '#ff0066'\n      }\n    }, __jsx(Link, {\n      href: \"/auth/login/user\",\n      as: \"/auth/login\"\n    }, __jsx(\"a\", null, \"Login\")));\n    return __jsx(Layout.Header, {\n      className: \"header\",\n      id: \"layoutHeader\"\n    }, __jsx(SoundPlayer, {\n      ref: ref => this.soundRef = ref,\n      soundUrl: tipSound\n    }), __jsx(\"div\", {\n      className: \"left-container\"\n    }, __jsx(Link, {\n      href: \"/cams\",\n      shallow: true,\n      as: \"/\"\n    }, __jsx(\"a\", {\n      className: \"header-logo\"\n    }, __jsx(\"img\", {\n      src: typeof ui.logo === 'string' && ui.logo.length > 0 ? ui.logo : '/xcam-logo-white.png',\n      alt: \"header-logo\"\n    }))), __jsx(LeftHeaderContent, _extends({}, this.props, {\n      current: currentUser\n    }))), __jsx(\"div\", {\n      className: \"right-container\"\n    }, __jsx(\"div\", {\n      className: showSearch ? 'search-icon active' : 'search-icon',\n      \"aria-hidden\": true,\n      onClick: () => this.setState({\n        showSearch: !showSearch\n      })\n    }, showSearch ? __jsx(CloseOutlined, null) : __jsx(SearchOutlined, null)), __jsx(\"div\", {\n      className: !showSearch ? 'hide search-bar' : 'search-bar'\n    }, __jsx(Input.Search, {\n      placeholder: \"Enter keyword\",\n      loading: false,\n      allowClear: true,\n      enterButton: true,\n      onPressEnter: this.onPressEnter.bind(this),\n      onSearch: this.onSearchPerformer.bind(this)\n    })), rightContent));\n  }\n\n}\n\nHeader.contextType = SocketContext;\n\nconst userSelecter = state => state.user.current;\n\nconst performerSelecter = state => state.performer.current;\n\nconst studioSelecter = state => state.studio.current;\n\nconst authSelecter = state => state.auth;\n\nconst currentUserSelecter = createSelector(userSelecter, performerSelecter, studioSelecter, authSelecter, (user, performer, studio, auth) => {\n  if (!auth.loggedIn) return {};\n\n  if (user !== null && user !== void 0 && user._id) {\n    return _objectSpread(_objectSpread({}, user), {}, {\n      role: 'user'\n    });\n  }\n\n  if (performer !== null && performer !== void 0 && performer._id) {\n    return _objectSpread(_objectSpread({}, performer), {}, {\n      role: 'performer'\n    });\n  }\n\n  if (studio !== null && studio !== void 0 && studio._id) {\n    return _objectSpread(_objectSpread({}, studio), {}, {\n      role: 'studio'\n    });\n  }\n\n  return {};\n});\nHeader.contextType = SocketContext;\n\nconst mapStateToProps = state => _objectSpread({\n  ui: _objectSpread({}, state.ui),\n  currentUser: currentUserSelecter(state),\n  tipSound: state.settings.tipSound,\n  loggedIn: state.auth.loggedIn,\n  performerCategories: state.performer.categories,\n  totalNotReadMessage: state.message.totalNotReadMessage\n}, state.streaming);\n\nconst mapDispatch = {\n  logout,\n  getPerformerCategories,\n  getCountries,\n  addPrivateRequest,\n  getStudioStats,\n  countNotReadMessage\n};\nexport default connect(mapStateToProps, mapDispatch)(withRouter(Header));","map":{"version":3,"sources":["/Users/frag-games/Desktop/Test Projects/secret-client/src/components/common/layout/header.tsx"],"names":["React","PureComponent","SettingOutlined","HeartOutlined","MessageOutlined","UserOutlined","LogoutOutlined","SearchOutlined","CloseOutlined","BellOutlined","FundsIcon","Layout","Menu","Avatar","Input","Button","Dropdown","Badge","Card","message","Tooltip","messageService","createSelector","connect","Link","Router","withRouter","logout","getPerformerCategories","getCountries","SocketContext","addPrivateRequest","dynamic","formatDate","getStudioStats","SoundPlayer","countNotReadMessage","NumberFormat","SETTING_KEYS","LeftHeaderContent","ssr","roundBalance","balance","Math","round","EVENT","RECEIVED_PRIVATE_CHAT_REQUEST","NOTIFY_READ_MESSAGE","TIPPED","Header","constructor","props","event","dispatchCountNotReadMessage","total","data","dispatchAddPrivateRequest","settings","path","OPTION_FOR_PRIVATE","success","content","user","username","duration","key","conversationId","onClick","push","pathname","query","id","soundRef","play","createdAt","Date","token","senderInfo","toFixed","socket","context","currentUser","connected","role","on","handlePrivateChat","sendTipHandler","handleMessage","state","showSearch","componentDidMount","dispatchGetPerformerCategories","dispatchGetCountries","dispatchGetStudioStats","loggedIn","limit","_id","countTotalNotRead","initSocketEvent","checkPermissionAccess","componentDidUpdate","prevProps","router","unauthorized","setTimeout","componentWillUnmount","off","onSearchPerformer","search","onPressEnter","target","currentTarget","value","q","beforeLogout","dispatchLogout","replace","render","ui","privateRequests","tipSound","totalNotReadMessage","rightContent","margin","color","length","map","request","destroy","streamId","avatar","bind","cursor","background","marginLeft","marginRight","ref","logo","setState","contextType","userSelecter","current","performerSelecter","performer","studioSelecter","studio","authSelecter","auth","currentUserSelecter","mapStateToProps","performerCategories","categories","streaming","mapDispatch"],"mappings":"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","sourcesContent":["/* eslint-disable no-return-assign */\nimport React, { PureComponent } from 'react';\nimport {\n  SettingOutlined,\n  HeartOutlined,\n  MessageOutlined,\n  UserOutlined,\n  LogoutOutlined,\n  SearchOutlined,\n  CloseOutlined,\n  BellOutlined\n} from '@ant-design/icons';\nimport { FundsIcon } from '@components/common/base/icons';\nimport {\n  Layout,\n  Menu,\n  Avatar,\n  Input,\n  Button,\n  Dropdown,\n  Badge,\n  Card,\n  message,\n  Tooltip\n} from 'antd';\nimport { messageService } from 'src/services/index';\nimport { createSelector } from 'reselect';\nimport { connect } from 'react-redux';\nimport Link from 'next/link';\nimport Router, { withRouter, NextRouter } from 'next/router';\nimport {\n  IUser,\n  IPerformerCategogies,\n  IDataResponse,\n  IPerformer,\n  IStudio,\n  IUIConfig,\n  StreamSettings\n} from 'src/interfaces';\nimport { logout } from '@redux/auth/actions';\nimport { getPerformerCategories } from '@redux/performer/actions';\nimport { getCountries } from '@redux/settings/actions';\nimport { SocketContext } from 'src/socket';\nimport { addPrivateRequest } from '@redux/streaming/actions';\nimport dynamic from 'next/dynamic';\nimport { formatDate } from 'src/lib';\nimport { getStudioStats } from 'src/redux/studio/actions';\nimport SoundPlayer from 'src/components/common/base/sound';\nimport { countNotReadMessage } from '@redux/message/actions';\nimport NumberFormat from '@components/common/layout/numberformat';\n\nimport './header.less';\nimport { SETTING_KEYS } from 'src/constants';\n\nconst LeftHeaderContent = dynamic(() => import('./left-header-content'), {\n  ssr: false\n});\n\nconst roundBalance = (balance: number) => {\n  if (balance < 10000) return Math.round(balance);\n  return '9999+';\n};\n\nconst EVENT = {\n  RECEIVED_PRIVATE_CHAT_REQUEST: 'private-chat-request',\n  NOTIFY_READ_MESSAGE: 'nofify_read_messages_in_conversation',\n  TIPPED: 'tipped'\n};\n\ninterface P {\n  collapsed?: boolean;\n  onCollapseChange?: Function;\n  loggedIn?: boolean;\n  logout?: Function;\n  ui?: IUIConfig;\n  getCountries?: Function;\n  getPerformerCategories?: Function;\n  performerCategories?: IDataResponse<IPerformerCategogies>;\n  searchPerformer?: Function;\n  addPrivateRequest?: Function;\n  countNotReadMessage?: Function;\n  totalNotReadMessage?: number;\n  router: NextRouter;\n  privateRequests?: any;\n  getStudioStats?: Function;\n  role?: string;\n  tipSound?: string;\n  currentUser?: IUser & IPerformer & IStudio;\n  settings?: StreamSettings;\n}\n\ninterface S {\n  showSearch: boolean;\n}\n\nclass Header extends PureComponent<P, S> {\n  private soundRef;\n\n  private socket: SocketIOClient.Socket;\n\n  constructor(props: P) {\n    super(props);\n    this.state = {\n      showSearch: false\n    };\n  }\n\n  async componentDidMount() {\n    const {\n      getPerformerCategories: dispatchGetPerformerCategories,\n      getCountries: dispatchGetCountries,\n      getStudioStats: dispatchGetStudioStats,\n      currentUser,\n      loggedIn,\n      countNotReadMessage: dispatchCountNotReadMessage\n    } = this.props;\n    // this.socket = this.context;\n    dispatchGetPerformerCategories({ limit: 0 });\n    dispatchGetCountries();\n    if (currentUser?._id) {\n      const data = await (await messageService.countTotalNotRead()).data;\n      if (data) {\n        dispatchCountNotReadMessage(data.total);\n      }\n    }\n\n    if (currentUser?._id && currentUser.role === 'studio') {\n      dispatchGetStudioStats();\n    }\n\n    if (loggedIn) {\n      this.initSocketEvent();\n      this.checkPermissionAccess();\n    }\n  }\n\n  componentDidUpdate(prevProps: P) {\n    const {\n      loggedIn,\n      router: {\n        query: { unauthorized }\n      }\n    } = this.props;\n    if (loggedIn && prevProps.loggedIn !== loggedIn) {\n      setTimeout(this.initSocketEvent, 1000);\n    }\n\n    if (unauthorized !== prevProps.router.query.unauthorized) {\n      this.checkPermissionAccess();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.socket) {\n      this.socket.off(EVENT.NOTIFY_READ_MESSAGE);\n      this.socket.off(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST);\n      this.socket.off(EVENT.TIPPED);\n    }\n  }\n\n  onSearchPerformer(key: string) {\n    this.search(key);\n  }\n\n  onPressEnter(event) {\n    const target = event.currentTarget as HTMLInputElement;\n    const key = target.value;\n    this.search(key);\n  }\n\n  handleMessage = (event) => {\n    const { countNotReadMessage: dispatchCountNotReadMessage } = this.props;\n    event && dispatchCountNotReadMessage(event.total);\n  };\n\n  handlePrivateChat = (data: { conversationId: string; user: IUser }) => {\n    const { addPrivateRequest: dispatchAddPrivateRequest, settings } = this.props;\n    const path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n    message.success({\n      content: (\n        <span>\n          {data.user.username}\n          {' '}\n          sent you a private chat request.\n        </span>\n      ),\n      duration: 10,\n      key: data.conversationId,\n      onClick: () => Router.push(\n        {\n          pathname: `/live/${path}privatechat`,\n          query: { id: data.conversationId }\n        },\n        `/live/${path}privatechat/${data.conversationId}`\n      )\n    });\n    this.soundRef && this.soundRef.play();\n    dispatchAddPrivateRequest({ ...data, createdAt: new Date() });\n  };\n\n  sendTipHandler = ({ token, senderInfo }) => {\n    message.success(\n      `${senderInfo.username} tip ${token?.toFixed(2)} tokens`,\n      10\n    );\n    this.soundRef && this.soundRef.play();\n  };\n\n  initSocketEvent = () => {\n    this.socket = this.context;\n    const { currentUser } = this.props;\n    if (this.socket.connected) {\n      if (currentUser.role === 'performer') {\n        this.socket.on(\n          EVENT.RECEIVED_PRIVATE_CHAT_REQUEST,\n          this.handlePrivateChat\n        );\n        this.socket.on(EVENT.TIPPED, this.sendTipHandler);\n      }\n\n      this.socket.on(EVENT.NOTIFY_READ_MESSAGE, this.handleMessage);\n    } else {\n      this.socket.on('connect', () => {\n        if (currentUser.role === 'performer') {\n          this.socket.on(\n            EVENT.RECEIVED_PRIVATE_CHAT_REQUEST,\n            this.handlePrivateChat\n          );\n          this.socket.on(EVENT.TIPPED, this.sendTipHandler);\n        }\n\n        this.socket.on(EVENT.NOTIFY_READ_MESSAGE, this.handleMessage);\n      });\n    }\n  };\n\n  search(key: string) {\n    Router.push({\n      pathname: '/cams',\n      query: { q: key }\n    }, `/cams?q=${key}`);\n  }\n\n  async checkPermissionAccess() {\n    const {\n      loggedIn,\n      router: {\n        query: { unauthorized }\n      }\n    } = this.props;\n    if (!loggedIn || !unauthorized) {\n      return;\n    }\n\n    this.beforeLogout();\n  }\n\n  async beforeLogout() {\n    const { logout: dispatchLogout } = this.props;\n    dispatchLogout();\n    Router.replace('/');\n  }\n\n  render() {\n    const {\n      ui,\n      loggedIn,\n      privateRequests,\n      currentUser,\n      tipSound,\n      totalNotReadMessage,\n      settings\n    } = this.props;\n    const { showSearch } = this.state;\n    const path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n    const rightContent = loggedIn ? (\n      <>\n        <Link\n          href={\n            loggedIn && currentUser.role === 'user'\n              ? '/account/user/funds-tokens'\n              : '#'\n          }\n        >\n          <Tooltip\n            title={`${\n              (currentUser.balance && currentUser.balance.toFixed(2)) || 0\n            } Tokens`}\n          >\n            <Button\n              style={{ margin: '0px 10px', color: '#ff0066' }}\n              className=\"btn-tokens\"\n            >\n              {`${roundBalance(currentUser?.balance || 0)} Tokens`}\n            </Button>\n          </Tooltip>\n        </Link>\n        {currentUser.role === 'performer' && (\n          <Dropdown\n            overlay={(\n              <Menu>\n                {privateRequests.length > 0 ? (\n                  privateRequests.map((request) => (\n                    <Menu.Item\n                      onClick={() => message.destroy(request.conversationId)}\n                    >\n                      <Link\n                        href={{\n                          pathname: `/live/${path}privatechat`,\n                          query: { id: request.conversationId, streamId: request.id }\n                        }}\n                        as={`/live/${path}privatechat/${request.conversationId}?streamId=${request.id}`}\n                        key={request.conversationId}\n                      >\n                        <a>\n                          <Card bordered={false} hoverable={false}>\n                            <Card.Meta\n                              avatar={(\n                                <Avatar\n                                  src={\n                                    request.user?.avatar\n                                    || '/default-user-icon.png'\n                                  }\n                                />\n                              )}\n                              title={(\n                                <>\n                                  <span>{request.user?.username}</span>\n                                  {' '}\n                                  (\n                                  <NumberFormat\n                                    value={request.user?.balance || 0}\n                                    suffix=\" tokens\"\n                                  />\n                                  )\n                                </>\n                              )}\n                              description={formatDate(request?.createdAt)}\n                            />\n                          </Card>\n                        </a>\n                      </Link>\n                    </Menu.Item>\n                  ))\n                ) : (\n                  <Menu.Item>There are no private request.</Menu.Item>\n                )}\n              </Menu>\n            )}\n          >\n            <span className=\"call-requests\">\n              <Badge count={privateRequests.length} showZero>\n                <BellOutlined style={{ color: '#ffffff' }} />\n              </Badge>\n            </span>\n          </Dropdown>\n        )}\n        <Dropdown\n          overlay={(\n            <Menu key=\"menu-right-content\">\n              {currentUser.role === 'user' && [\n                <Menu.Item\n                  key=\"settings-menu-right-content\"\n                  onClick={() => Router.push('/account/user/account-settings')}\n                >\n                  <span>\n                    <SettingOutlined className=\"primary-icon\" />\n                    {' '}\n                    Profile\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"favorite-menu-right-content\"\n                  onClick={() => Router.push('/account/user/favorites')}\n                >\n                  <span>\n                    <HeartOutlined className=\"primary-icon\" />\n                    {' '}\n                    My Favorites\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"funds-tokens-menu-right-content\"\n                  onClick={() => Router.push('/account/user/funds-tokens')}\n                >\n                  <span>\n                    <span className=\"anticon primary-icon\">\n                      <FundsIcon />\n                    </span>\n                    {' '}\n                    Funds / Tokens\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"user-messages-menu-right-content\"\n                  onClick={() => Router.push('/messages')}\n                >\n                  <span>\n                    <MessageOutlined className=\"primary-icon\" />\n                    {' '}\n                    Messages (\n                    {totalNotReadMessage || 0}\n                    )\n                  </span>\n                </Menu.Item>\n              ]}\n\n              {currentUser.role === 'performer' && [\n                <Menu.Item\n                  key=\"profile-menu-right-content\"\n                  onClick={() => Router.push('/account/performer/profile')}\n                >\n                  <span>\n                    <UserOutlined className=\"primary-icon\" />\n                    {' '}\n                    Profile\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"account-settings-menu-right-content\"\n                  onClick={() => Router.push('/account/performer/account-settings')}\n                >\n                  <span>\n                    <SettingOutlined className=\"primary-icon\" />\n                    {' '}\n                    Account\n                    Settings\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"model-messages-menu-right-content\"\n                  onClick={() => Router.push('/messages')}\n                >\n                  <span>\n                    <MessageOutlined className=\"primary-icon\" />\n                    {' '}\n                    Messages (\n                    {totalNotReadMessage}\n                    )\n                  </span>\n                </Menu.Item>\n              ]}\n              {currentUser.role === 'studio' && [\n                <Menu.Item\n                  key=\"account-settings-menu-right-content\"\n                  onClick={() => Router.push('/studio/account-settings')}\n                >\n                  <span>\n                    <SettingOutlined className=\"primary-icon\" />\n                    {' '}\n                    Account\n                    Settings\n                  </span>\n                </Menu.Item>\n              ]}\n              <Menu.Item key=\"log-out\" onClick={this.beforeLogout.bind(this)}>\n                <LogoutOutlined className=\"primary-icon\" />\n                {' '}\n                Log out\n              </Menu.Item>\n            </Menu>\n          )}\n        >\n          <Avatar\n            style={{\n              margin: '0 15px',\n              cursor: 'pointer',\n              background: '#ffffff'\n            }}\n            src={currentUser?.avatar || '/default-user-icon.png'}\n          />\n        </Dropdown>\n      </>\n    ) : (\n      <Button style={{ marginLeft: 20, marginRight: 10, color: '#ff0066' }}>\n        <Link href=\"/auth/login/user\" as=\"/auth/login\">\n          <a>Login</a>\n        </Link>\n      </Button>\n    );\n\n    return (\n      <Layout.Header className=\"header\" id=\"layoutHeader\">\n        <SoundPlayer ref={(ref) => (this.soundRef = ref)} soundUrl={tipSound} />\n        <div className=\"left-container\">\n          <Link href=\"/cams\" shallow as=\"/\">\n            <a className=\"header-logo\">\n              <img\n                src={\n                  typeof ui.logo === 'string' && ui.logo.length > 0\n                    ? ui.logo\n                    : '/xcam-logo-white.png'\n                }\n                alt=\"header-logo\"\n              />\n            </a>\n          </Link>\n          <LeftHeaderContent {...this.props} current={currentUser} />\n        </div>\n        <div className=\"right-container\">\n          <div\n            className={showSearch ? 'search-icon active' : 'search-icon'}\n            aria-hidden\n            onClick={() => this.setState({ showSearch: !showSearch })}\n          >\n            {showSearch ? <CloseOutlined /> : <SearchOutlined />}\n          </div>\n          <div className={!showSearch ? 'hide search-bar' : 'search-bar'}>\n            <Input.Search\n              placeholder=\"Enter keyword\"\n              loading={false}\n              allowClear\n              enterButton\n              onPressEnter={this.onPressEnter.bind(this)}\n              onSearch={this.onSearchPerformer.bind(this)}\n            />\n          </div>\n          {rightContent}\n        </div>\n      </Layout.Header>\n    );\n  }\n}\n\nHeader.contextType = SocketContext;\n\nconst userSelecter = (state) => state.user.current;\nconst performerSelecter = (state) => state.performer.current;\nconst studioSelecter = (state) => state.studio.current;\nconst authSelecter = (state) => state.auth;\n\nconst currentUserSelecter = createSelector(\n  userSelecter,\n  performerSelecter,\n  studioSelecter,\n  authSelecter,\n  (user, performer, studio, auth) => {\n    if (!auth.loggedIn) return {};\n\n    if (user?._id) {\n      return { ...user, role: 'user' };\n    }\n\n    if (performer?._id) {\n      return { ...performer, role: 'performer' };\n    }\n\n    if (studio?._id) {\n      return { ...studio, role: 'studio' };\n    }\n\n    return {};\n  }\n);\n\nHeader.contextType = SocketContext;\n\nconst mapStateToProps = (state: any) => ({\n  ui: { ...state.ui },\n  currentUser: currentUserSelecter(state),\n  tipSound: state.settings.tipSound,\n  loggedIn: state.auth.loggedIn,\n  performerCategories: state.performer.categories,\n  totalNotReadMessage: state.message.totalNotReadMessage,\n  ...state.streaming\n});\nconst mapDispatch = {\n  logout,\n  getPerformerCategories,\n  getCountries,\n  addPrivateRequest,\n  getStudioStats,\n  countNotReadMessage\n};\nexport default connect(mapStateToProps, mapDispatch)(withRouter(Header));\n"]},"metadata":{},"sourceType":"module"}