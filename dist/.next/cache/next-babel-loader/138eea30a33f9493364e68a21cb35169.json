{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"@babel/runtime/helpers/esm/defineProperty\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) { symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); } keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Boolean.prototype.valueOf.call(Reflect.construct(Boolean, [], function () {})); return true; } catch (e) { return false; } }\n\n/* eslint-disable no-return-assign */\nimport React, { PureComponent } from 'react';\nimport { SettingOutlined, HeartOutlined, MessageOutlined, UserOutlined, LogoutOutlined, SearchOutlined, CloseOutlined, BellOutlined } from '@ant-design/icons';\nimport { FundsIcon } from '@components/common/base/icons';\nimport { Layout, Menu, Avatar, Input, Button, Dropdown, Badge, Card, message, Tooltip } from 'antd';\nimport { messageService } from 'src/services/index';\nimport { createSelector } from 'reselect';\nimport { connect } from 'react-redux';\nimport Link from 'next/link';\nimport Router, { withRouter } from 'next/router';\nimport { logout } from '@redux/auth/actions';\nimport { getPerformerCategories } from '@redux/performer/actions';\nimport { getCountries } from '@redux/settings/actions';\nimport { SocketContext } from 'src/socket';\nimport { addPrivateRequest } from '@redux/streaming/actions';\nimport dynamic from 'next/dynamic';\nimport { formatDate } from 'src/lib';\nimport { getStudioStats } from 'src/redux/studio/actions';\nimport SoundPlayer from 'src/components/common/base/sound';\nimport { countNotReadMessage } from '@redux/message/actions';\nimport NumberFormat from '@components/common/layout/numberformat';\nimport './header.less';\nimport { SETTING_KEYS } from 'src/constants';\nvar LeftHeaderContent = dynamic(_c = function _c() {\n  return import('./left-header-content');\n}, {\n  ssr: false,\n  loadableGenerated: {\n    webpack: function webpack() {\n      return [require.resolveWeak('./left-header-content')];\n    },\n    modules: ['./left-header-content']\n  }\n});\n_c2 = LeftHeaderContent;\n\nvar roundBalance = function roundBalance(balance) {\n  if (balance < 10000) return Math.round(balance);\n  return '9999+';\n};\n\nvar EVENT = {\n  RECEIVED_PRIVATE_CHAT_REQUEST: 'private-chat-request',\n  NOTIFY_READ_MESSAGE: 'nofify_read_messages_in_conversation',\n  TIPPED: 'tipped'\n};\n\nvar Header = /*#__PURE__*/function (_PureComponent) {\n  _inherits(Header, _PureComponent);\n\n  var _super = _createSuper(Header);\n\n  function Header(props) {\n    var _this;\n\n    _classCallCheck(this, Header);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"soundRef\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"socket\", void 0);\n\n    _defineProperty(_assertThisInitialized(_this), \"handleMessage\", function (event) {\n      var dispatchCountNotReadMessage = _this.props.countNotReadMessage;\n      event && dispatchCountNotReadMessage(event.total);\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"handlePrivateChat\", function (data) {\n      var _this$props = _this.props,\n          dispatchAddPrivateRequest = _this$props.addPrivateRequest,\n          settings = _this$props.settings;\n      var path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n      message.success({\n        content: __jsx(\"span\", null, data.user.username, ' ', \"sent you a private chat request.\"),\n        duration: 10,\n        key: data.conversationId,\n        onClick: function onClick() {\n          return Router.push({\n            pathname: \"/live/\".concat(path, \"privatechat\"),\n            query: {\n              id: data.conversationId\n            }\n          }, \"/live/\".concat(path, \"privatechat/\").concat(data.conversationId));\n        }\n      });\n      _this.soundRef && _this.soundRef.play();\n      dispatchAddPrivateRequest(_objectSpread(_objectSpread({}, data), {}, {\n        createdAt: new Date()\n      }));\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"sendTipHandler\", function (_ref) {\n      var token = _ref.token,\n          senderInfo = _ref.senderInfo;\n      message.success(\"\".concat(senderInfo.username, \" tip \").concat(token === null || token === void 0 ? void 0 : token.toFixed(2), \" tokens\"), 10);\n      _this.soundRef && _this.soundRef.play();\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"initSocketEvent\", function () {\n      _this.socket = _this.context;\n      var currentUser = _this.props.currentUser;\n\n      if (_this.socket.connected) {\n        if (currentUser.role === 'performer') {\n          _this.socket.on(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST, _this.handlePrivateChat);\n\n          _this.socket.on(EVENT.TIPPED, _this.sendTipHandler);\n        }\n\n        _this.socket.on(EVENT.NOTIFY_READ_MESSAGE, _this.handleMessage);\n      } else {\n        _this.socket.on('connect', function () {\n          if (currentUser.role === 'performer') {\n            _this.socket.on(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST, _this.handlePrivateChat);\n\n            _this.socket.on(EVENT.TIPPED, _this.sendTipHandler);\n          }\n\n          _this.socket.on(EVENT.NOTIFY_READ_MESSAGE, _this.handleMessage);\n        });\n      }\n    });\n\n    _this.state = {\n      showSearch: false\n    };\n    return _this;\n  }\n\n  _createClass(Header, [{\n    key: \"componentDidMount\",\n    value: function () {\n      var _componentDidMount = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        var _this$props2, dispatchGetPerformerCategories, dispatchGetCountries, dispatchGetStudioStats, currentUser, loggedIn, dispatchCountNotReadMessage, data;\n\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                _this$props2 = this.props, dispatchGetPerformerCategories = _this$props2.getPerformerCategories, dispatchGetCountries = _this$props2.getCountries, dispatchGetStudioStats = _this$props2.getStudioStats, currentUser = _this$props2.currentUser, loggedIn = _this$props2.loggedIn, dispatchCountNotReadMessage = _this$props2.countNotReadMessage; // this.socket = this.context;\n\n                dispatchGetPerformerCategories({\n                  limit: 0\n                });\n                dispatchGetCountries();\n\n                if (!(currentUser !== null && currentUser !== void 0 && currentUser._id)) {\n                  _context.next = 10;\n                  break;\n                }\n\n                _context.next = 6;\n                return messageService.countTotalNotRead();\n\n              case 6:\n                _context.next = 8;\n                return _context.sent.data;\n\n              case 8:\n                data = _context.sent;\n\n                if (data) {\n                  dispatchCountNotReadMessage(data.total);\n                }\n\n              case 10:\n                if (currentUser !== null && currentUser !== void 0 && currentUser._id && currentUser.role === 'studio') {\n                  dispatchGetStudioStats();\n                }\n\n                if (loggedIn) {\n                  this.initSocketEvent();\n                  this.checkPermissionAccess();\n                }\n\n              case 12:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee, this);\n      }));\n\n      function componentDidMount() {\n        return _componentDidMount.apply(this, arguments);\n      }\n\n      return componentDidMount;\n    }()\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps) {\n      var _this$props3 = this.props,\n          loggedIn = _this$props3.loggedIn,\n          unauthorized = _this$props3.router.query.unauthorized;\n\n      if (loggedIn && prevProps.loggedIn !== loggedIn) {\n        setTimeout(this.initSocketEvent, 1000);\n      }\n\n      if (unauthorized !== prevProps.router.query.unauthorized) {\n        this.checkPermissionAccess();\n      }\n    }\n  }, {\n    key: \"componentWillUnmount\",\n    value: function componentWillUnmount() {\n      if (this.socket) {\n        this.socket.off(EVENT.NOTIFY_READ_MESSAGE);\n        this.socket.off(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST);\n        this.socket.off(EVENT.TIPPED);\n      }\n    }\n  }, {\n    key: \"onSearchPerformer\",\n    value: function onSearchPerformer(key) {\n      this.search(key);\n    }\n  }, {\n    key: \"onPressEnter\",\n    value: function onPressEnter(event) {\n      var target = event.currentTarget;\n      var key = target.value;\n      this.search(key);\n    }\n  }, {\n    key: \"search\",\n    value: function search(key) {\n      Router.push({\n        pathname: '/cams',\n        query: {\n          q: key\n        }\n      }, \"/cams?q=\".concat(key));\n    }\n  }, {\n    key: \"checkPermissionAccess\",\n    value: function () {\n      var _checkPermissionAccess = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var _this$props4, loggedIn, unauthorized;\n\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _this$props4 = this.props, loggedIn = _this$props4.loggedIn, unauthorized = _this$props4.router.query.unauthorized;\n\n                if (!(!loggedIn || !unauthorized)) {\n                  _context2.next = 3;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\");\n\n              case 3:\n                this.beforeLogout();\n\n              case 4:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function checkPermissionAccess() {\n        return _checkPermissionAccess.apply(this, arguments);\n      }\n\n      return checkPermissionAccess;\n    }()\n  }, {\n    key: \"beforeLogout\",\n    value: function () {\n      var _beforeLogout = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3() {\n        var dispatchLogout;\n        return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                dispatchLogout = this.props.logout;\n                dispatchLogout();\n                Router.replace('/');\n\n              case 3:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3, this);\n      }));\n\n      function beforeLogout() {\n        return _beforeLogout.apply(this, arguments);\n      }\n\n      return beforeLogout;\n    }()\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$props5 = this.props,\n          ui = _this$props5.ui,\n          loggedIn = _this$props5.loggedIn,\n          privateRequests = _this$props5.privateRequests,\n          currentUser = _this$props5.currentUser,\n          tipSound = _this$props5.tipSound,\n          totalNotReadMessage = _this$props5.totalNotReadMessage,\n          settings = _this$props5.settings;\n      var showSearch = this.state.showSearch;\n      var path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n      var rightContent = loggedIn ? __jsx(React.Fragment, null, __jsx(Link, {\n        href: loggedIn && currentUser.role === 'user' ? '/account/user/funds-tokens' : '#'\n      }, __jsx(Tooltip, {\n        title: \"\".concat(currentUser.balance && currentUser.balance.toFixed(2) || 0, \" Tokens\")\n      }, __jsx(Button, {\n        style: {\n          margin: '0px 10px',\n          color: '#ff0066'\n        },\n        className: \"btn-tokens\"\n      }, \"\".concat(roundBalance((currentUser === null || currentUser === void 0 ? void 0 : currentUser.balance) || 0), \" Tokens\")))), currentUser.role === 'performer' && __jsx(Dropdown, {\n        overlay: __jsx(Menu, null, privateRequests.length > 0 ? privateRequests.map(function (request) {\n          var _request$user, _request$user2, _request$user3;\n\n          return __jsx(Menu.Item, {\n            onClick: function onClick() {\n              return message.destroy(request.conversationId);\n            }\n          }, __jsx(Link, {\n            href: {\n              pathname: \"/live/\".concat(path, \"privatechat\"),\n              query: {\n                id: request.conversationId,\n                streamId: request.id\n              }\n            },\n            as: \"/live/\".concat(path, \"privatechat/\").concat(request.conversationId, \"?streamId=\").concat(request.id),\n            key: request.conversationId\n          }, __jsx(\"a\", null, __jsx(Card, {\n            bordered: false,\n            hoverable: false\n          }, __jsx(Card.Meta, {\n            avatar: __jsx(Avatar, {\n              src: ((_request$user = request.user) === null || _request$user === void 0 ? void 0 : _request$user.avatar) || '/default-user-icon.png'\n            }),\n            title: __jsx(React.Fragment, null, __jsx(\"span\", null, (_request$user2 = request.user) === null || _request$user2 === void 0 ? void 0 : _request$user2.username), ' ', \"(\", __jsx(NumberFormat, {\n              value: ((_request$user3 = request.user) === null || _request$user3 === void 0 ? void 0 : _request$user3.balance) || 0,\n              suffix: \" tokens\"\n            }), \")\"),\n            description: formatDate(request === null || request === void 0 ? void 0 : request.createdAt)\n          })))));\n        }) : __jsx(Menu.Item, null, \"There are no private request.\"))\n      }, __jsx(\"span\", {\n        className: \"call-requests\"\n      }, __jsx(Badge, {\n        count: privateRequests.length,\n        showZero: true\n      }, __jsx(BellOutlined, {\n        style: {\n          color: '#ffffff'\n        }\n      })))), __jsx(Dropdown, {\n        overlay: __jsx(Menu, {\n          key: \"menu-right-content\"\n        }, currentUser.role === 'user' && [__jsx(Menu.Item, {\n          key: \"settings-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/account/user/account-settings');\n          }\n        }, __jsx(\"span\", null, __jsx(SettingOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"Profile\")), __jsx(Menu.Item, {\n          key: \"favorite-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/account/user/favorites');\n          }\n        }, __jsx(\"span\", null, __jsx(HeartOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"My Favorites\")), __jsx(Menu.Item, {\n          key: \"funds-tokens-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/account/user/funds-tokens');\n          }\n        }, __jsx(\"span\", null, __jsx(\"span\", {\n          className: \"anticon primary-icon\"\n        }, __jsx(FundsIcon, null)), ' ', \"Funds / Tokens\")), __jsx(Menu.Item, {\n          key: \"user-messages-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/messages');\n          }\n        }, __jsx(\"span\", null, __jsx(MessageOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"Messages (\", totalNotReadMessage || 0, \")\"))], currentUser.role === 'performer' && [__jsx(Menu.Item, {\n          key: \"profile-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/account/performer/profile');\n          }\n        }, __jsx(\"span\", null, __jsx(UserOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"Profile\")), __jsx(Menu.Item, {\n          key: \"account-settings-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/account/performer/account-settings');\n          }\n        }, __jsx(\"span\", null, __jsx(SettingOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"Account Settings\")), __jsx(Menu.Item, {\n          key: \"model-messages-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/messages');\n          }\n        }, __jsx(\"span\", null, __jsx(MessageOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"Messages (\", totalNotReadMessage, \")\"))], currentUser.role === 'studio' && [__jsx(Menu.Item, {\n          key: \"account-settings-menu-right-content\",\n          onClick: function onClick() {\n            return Router.push('/studio/account-settings');\n          }\n        }, __jsx(\"span\", null, __jsx(SettingOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"Account Settings\"))], __jsx(Menu.Item, {\n          key: \"log-out\",\n          onClick: this.beforeLogout.bind(this)\n        }, __jsx(LogoutOutlined, {\n          className: \"primary-icon\"\n        }), ' ', \"Log out\"))\n      }, __jsx(Avatar, {\n        style: {\n          margin: '0 15px',\n          cursor: 'pointer',\n          background: '#ffffff'\n        },\n        src: (currentUser === null || currentUser === void 0 ? void 0 : currentUser.avatar) || '/default-user-icon.png'\n      }))) : __jsx(Button, {\n        style: {\n          marginLeft: 20,\n          marginRight: 10,\n          color: '#ff0066'\n        }\n      }, __jsx(Link, {\n        href: \"/auth/login/user\",\n        as: \"/auth/login\"\n      }, __jsx(\"a\", null, \"Login\")));\n      return __jsx(Layout.Header, {\n        className: \"header\",\n        id: \"layoutHeader\"\n      }, __jsx(SoundPlayer, {\n        ref: function ref(_ref2) {\n          return _this2.soundRef = _ref2;\n        },\n        soundUrl: tipSound\n      }), __jsx(\"div\", {\n        className: \"left-container\"\n      }, __jsx(Link, {\n        href: \"/cams\",\n        shallow: true,\n        as: \"/\"\n      }, __jsx(\"a\", {\n        className: \"header-logo\"\n      }, __jsx(\"img\", {\n        src: typeof ui.logo === 'string' && ui.logo.length > 0 ? ui.logo : '/xcam-logo-white.png',\n        alt: \"header-logo\"\n      }))), __jsx(LeftHeaderContent, _extends({}, this.props, {\n        current: currentUser\n      }))), __jsx(\"div\", {\n        className: \"right-container\"\n      }, __jsx(\"div\", {\n        className: showSearch ? 'search-icon active' : 'search-icon',\n        \"aria-hidden\": true,\n        onClick: function onClick() {\n          return _this2.setState({\n            showSearch: !showSearch\n          });\n        }\n      }, showSearch ? __jsx(CloseOutlined, null) : __jsx(SearchOutlined, null)), __jsx(\"div\", {\n        className: !showSearch ? 'hide search-bar' : 'search-bar'\n      }, __jsx(Input.Search, {\n        placeholder: \"Enter keyword\",\n        loading: false,\n        allowClear: true,\n        enterButton: true,\n        onPressEnter: this.onPressEnter.bind(this),\n        onSearch: this.onSearchPerformer.bind(this)\n      })), rightContent));\n    }\n  }]);\n\n  return Header;\n}(PureComponent);\n\nHeader.contextType = SocketContext;\n\nvar userSelecter = function userSelecter(state) {\n  return state.user.current;\n};\n\nvar performerSelecter = function performerSelecter(state) {\n  return state.performer.current;\n};\n\nvar studioSelecter = function studioSelecter(state) {\n  return state.studio.current;\n};\n\nvar authSelecter = function authSelecter(state) {\n  return state.auth;\n};\n\nvar currentUserSelecter = createSelector(userSelecter, performerSelecter, studioSelecter, authSelecter, function (user, performer, studio, auth) {\n  if (!auth.loggedIn) return {};\n\n  if (user !== null && user !== void 0 && user._id) {\n    return _objectSpread(_objectSpread({}, user), {}, {\n      role: 'user'\n    });\n  }\n\n  if (performer !== null && performer !== void 0 && performer._id) {\n    return _objectSpread(_objectSpread({}, performer), {}, {\n      role: 'performer'\n    });\n  }\n\n  if (studio !== null && studio !== void 0 && studio._id) {\n    return _objectSpread(_objectSpread({}, studio), {}, {\n      role: 'studio'\n    });\n  }\n\n  return {};\n});\nHeader.contextType = SocketContext;\n\nvar mapStateToProps = function mapStateToProps(state) {\n  return _objectSpread({\n    ui: _objectSpread({}, state.ui),\n    currentUser: currentUserSelecter(state),\n    tipSound: state.settings.tipSound,\n    loggedIn: state.auth.loggedIn,\n    performerCategories: state.performer.categories,\n    totalNotReadMessage: state.message.totalNotReadMessage\n  }, state.streaming);\n};\n\nvar mapDispatch = {\n  logout: logout,\n  getPerformerCategories: getPerformerCategories,\n  getCountries: getCountries,\n  addPrivateRequest: addPrivateRequest,\n  getStudioStats: getStudioStats,\n  countNotReadMessage: countNotReadMessage\n};\nexport default connect(mapStateToProps, mapDispatch)(withRouter(Header));\n\nvar _c, _c2;\n\n$RefreshReg$(_c, \"LeftHeaderContent$dynamic\");\n$RefreshReg$(_c2, \"LeftHeaderContent\");","map":{"version":3,"sources":["/Users/frag-games/Desktop/Test Projects/secret-client/src/components/common/layout/header.tsx"],"names":["React","PureComponent","SettingOutlined","HeartOutlined","MessageOutlined","UserOutlined","LogoutOutlined","SearchOutlined","CloseOutlined","BellOutlined","FundsIcon","Layout","Menu","Avatar","Input","Button","Dropdown","Badge","Card","message","Tooltip","messageService","createSelector","connect","Link","Router","withRouter","logout","getPerformerCategories","getCountries","SocketContext","addPrivateRequest","dynamic","formatDate","getStudioStats","SoundPlayer","countNotReadMessage","NumberFormat","SETTING_KEYS","LeftHeaderContent","ssr","roundBalance","balance","Math","round","EVENT","RECEIVED_PRIVATE_CHAT_REQUEST","NOTIFY_READ_MESSAGE","TIPPED","Header","props","event","dispatchCountNotReadMessage","total","data","dispatchAddPrivateRequest","settings","path","OPTION_FOR_PRIVATE","success","content","user","username","duration","key","conversationId","onClick","push","pathname","query","id","soundRef","play","createdAt","Date","token","senderInfo","toFixed","socket","context","currentUser","connected","role","on","handlePrivateChat","sendTipHandler","handleMessage","state","showSearch","dispatchGetPerformerCategories","dispatchGetCountries","dispatchGetStudioStats","loggedIn","limit","_id","countTotalNotRead","initSocketEvent","checkPermissionAccess","prevProps","unauthorized","router","setTimeout","off","search","target","currentTarget","value","q","beforeLogout","dispatchLogout","replace","ui","privateRequests","tipSound","totalNotReadMessage","rightContent","margin","color","length","map","request","destroy","streamId","avatar","bind","cursor","background","marginLeft","marginRight","ref","logo","setState","onPressEnter","onSearchPerformer","contextType","userSelecter","current","performerSelecter","performer","studioSelecter","studio","authSelecter","auth","currentUserSelecter","mapStateToProps","performerCategories","categories","streaming","mapDispatch"],"mappings":"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","sourcesContent":["/* eslint-disable no-return-assign */\nimport React, { PureComponent } from 'react';\nimport {\n  SettingOutlined,\n  HeartOutlined,\n  MessageOutlined,\n  UserOutlined,\n  LogoutOutlined,\n  SearchOutlined,\n  CloseOutlined,\n  BellOutlined\n} from '@ant-design/icons';\nimport { FundsIcon } from '@components/common/base/icons';\nimport {\n  Layout,\n  Menu,\n  Avatar,\n  Input,\n  Button,\n  Dropdown,\n  Badge,\n  Card,\n  message,\n  Tooltip\n} from 'antd';\nimport { messageService } from 'src/services/index';\nimport { createSelector } from 'reselect';\nimport { connect } from 'react-redux';\nimport Link from 'next/link';\nimport Router, { withRouter, NextRouter } from 'next/router';\nimport {\n  IUser,\n  IPerformerCategogies,\n  IDataResponse,\n  IPerformer,\n  IStudio,\n  IUIConfig,\n  StreamSettings\n} from 'src/interfaces';\nimport { logout } from '@redux/auth/actions';\nimport { getPerformerCategories } from '@redux/performer/actions';\nimport { getCountries } from '@redux/settings/actions';\nimport { SocketContext } from 'src/socket';\nimport { addPrivateRequest } from '@redux/streaming/actions';\nimport dynamic from 'next/dynamic';\nimport { formatDate } from 'src/lib';\nimport { getStudioStats } from 'src/redux/studio/actions';\nimport SoundPlayer from 'src/components/common/base/sound';\nimport { countNotReadMessage } from '@redux/message/actions';\nimport NumberFormat from '@components/common/layout/numberformat';\n\nimport './header.less';\nimport { SETTING_KEYS } from 'src/constants';\n\nconst LeftHeaderContent = dynamic(() => import('./left-header-content'), {\n  ssr: false\n});\n\nconst roundBalance = (balance: number) => {\n  if (balance < 10000) return Math.round(balance);\n  return '9999+';\n};\n\nconst EVENT = {\n  RECEIVED_PRIVATE_CHAT_REQUEST: 'private-chat-request',\n  NOTIFY_READ_MESSAGE: 'nofify_read_messages_in_conversation',\n  TIPPED: 'tipped'\n};\n\ninterface P {\n  collapsed?: boolean;\n  onCollapseChange?: Function;\n  loggedIn?: boolean;\n  logout?: Function;\n  ui?: IUIConfig;\n  getCountries?: Function;\n  getPerformerCategories?: Function;\n  performerCategories?: IDataResponse<IPerformerCategogies>;\n  searchPerformer?: Function;\n  addPrivateRequest?: Function;\n  countNotReadMessage?: Function;\n  totalNotReadMessage?: number;\n  router: NextRouter;\n  privateRequests?: any;\n  getStudioStats?: Function;\n  role?: string;\n  tipSound?: string;\n  currentUser?: IUser & IPerformer & IStudio;\n  settings?: StreamSettings;\n}\n\ninterface S {\n  showSearch: boolean;\n}\n\nclass Header extends PureComponent<P, S> {\n  private soundRef;\n\n  private socket: SocketIOClient.Socket;\n\n  constructor(props: P) {\n    super(props);\n    this.state = {\n      showSearch: false\n    };\n  }\n\n  async componentDidMount() {\n    const {\n      getPerformerCategories: dispatchGetPerformerCategories,\n      getCountries: dispatchGetCountries,\n      getStudioStats: dispatchGetStudioStats,\n      currentUser,\n      loggedIn,\n      countNotReadMessage: dispatchCountNotReadMessage\n    } = this.props;\n    // this.socket = this.context;\n    dispatchGetPerformerCategories({ limit: 0 });\n    dispatchGetCountries();\n    if (currentUser?._id) {\n      const data = await (await messageService.countTotalNotRead()).data;\n      if (data) {\n        dispatchCountNotReadMessage(data.total);\n      }\n    }\n\n    if (currentUser?._id && currentUser.role === 'studio') {\n      dispatchGetStudioStats();\n    }\n\n    if (loggedIn) {\n      this.initSocketEvent();\n      this.checkPermissionAccess();\n    }\n  }\n\n  componentDidUpdate(prevProps: P) {\n    const {\n      loggedIn,\n      router: {\n        query: { unauthorized }\n      }\n    } = this.props;\n    if (loggedIn && prevProps.loggedIn !== loggedIn) {\n      setTimeout(this.initSocketEvent, 1000);\n    }\n\n    if (unauthorized !== prevProps.router.query.unauthorized) {\n      this.checkPermissionAccess();\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.socket) {\n      this.socket.off(EVENT.NOTIFY_READ_MESSAGE);\n      this.socket.off(EVENT.RECEIVED_PRIVATE_CHAT_REQUEST);\n      this.socket.off(EVENT.TIPPED);\n    }\n  }\n\n  onSearchPerformer(key: string) {\n    this.search(key);\n  }\n\n  onPressEnter(event) {\n    const target = event.currentTarget as HTMLInputElement;\n    const key = target.value;\n    this.search(key);\n  }\n\n  handleMessage = (event) => {\n    const { countNotReadMessage: dispatchCountNotReadMessage } = this.props;\n    event && dispatchCountNotReadMessage(event.total);\n  };\n\n  handlePrivateChat = (data: { conversationId: string; user: IUser }) => {\n    const { addPrivateRequest: dispatchAddPrivateRequest, settings } = this.props;\n    const path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n    message.success({\n      content: (\n        <span>\n          {data.user.username}\n          {' '}\n          sent you a private chat request.\n        </span>\n      ),\n      duration: 10,\n      key: data.conversationId,\n      onClick: () => Router.push(\n        {\n          pathname: `/live/${path}privatechat`,\n          query: { id: data.conversationId }\n        },\n        `/live/${path}privatechat/${data.conversationId}`\n      )\n    });\n    this.soundRef && this.soundRef.play();\n    dispatchAddPrivateRequest({ ...data, createdAt: new Date() });\n  };\n\n  sendTipHandler = ({ token, senderInfo }) => {\n    message.success(\n      `${senderInfo.username} tip ${token?.toFixed(2)} tokens`,\n      10\n    );\n    this.soundRef && this.soundRef.play();\n  };\n\n  initSocketEvent = () => {\n    this.socket = this.context;\n    const { currentUser } = this.props;\n    if (this.socket.connected) {\n      if (currentUser.role === 'performer') {\n        this.socket.on(\n          EVENT.RECEIVED_PRIVATE_CHAT_REQUEST,\n          this.handlePrivateChat\n        );\n        this.socket.on(EVENT.TIPPED, this.sendTipHandler);\n      }\n\n      this.socket.on(EVENT.NOTIFY_READ_MESSAGE, this.handleMessage);\n    } else {\n      this.socket.on('connect', () => {\n        if (currentUser.role === 'performer') {\n          this.socket.on(\n            EVENT.RECEIVED_PRIVATE_CHAT_REQUEST,\n            this.handlePrivateChat\n          );\n          this.socket.on(EVENT.TIPPED, this.sendTipHandler);\n        }\n\n        this.socket.on(EVENT.NOTIFY_READ_MESSAGE, this.handleMessage);\n      });\n    }\n  };\n\n  search(key: string) {\n    Router.push({\n      pathname: '/cams',\n      query: { q: key }\n    }, `/cams?q=${key}`);\n  }\n\n  async checkPermissionAccess() {\n    const {\n      loggedIn,\n      router: {\n        query: { unauthorized }\n      }\n    } = this.props;\n    if (!loggedIn || !unauthorized) {\n      return;\n    }\n\n    this.beforeLogout();\n  }\n\n  async beforeLogout() {\n    const { logout: dispatchLogout } = this.props;\n    dispatchLogout();\n    Router.replace('/');\n  }\n\n  render() {\n    const {\n      ui,\n      loggedIn,\n      privateRequests,\n      currentUser,\n      tipSound,\n      totalNotReadMessage,\n      settings\n    } = this.props;\n    const { showSearch } = this.state;\n    const path = settings[SETTING_KEYS.OPTION_FOR_PRIVATE] === 'webrtc' ? 'webrtc/' : '';\n    const rightContent = loggedIn ? (\n      <>\n        <Link\n          href={\n            loggedIn && currentUser.role === 'user'\n              ? '/account/user/funds-tokens'\n              : '#'\n          }\n        >\n          <Tooltip\n            title={`${\n              (currentUser.balance && currentUser.balance.toFixed(2)) || 0\n            } Tokens`}\n          >\n            <Button\n              style={{ margin: '0px 10px', color: '#ff0066' }}\n              className=\"btn-tokens\"\n            >\n              {`${roundBalance(currentUser?.balance || 0)} Tokens`}\n            </Button>\n          </Tooltip>\n        </Link>\n        {currentUser.role === 'performer' && (\n          <Dropdown\n            overlay={(\n              <Menu>\n                {privateRequests.length > 0 ? (\n                  privateRequests.map((request) => (\n                    <Menu.Item\n                      onClick={() => message.destroy(request.conversationId)}\n                    >\n                      <Link\n                        href={{\n                          pathname: `/live/${path}privatechat`,\n                          query: { id: request.conversationId, streamId: request.id }\n                        }}\n                        as={`/live/${path}privatechat/${request.conversationId}?streamId=${request.id}`}\n                        key={request.conversationId}\n                      >\n                        <a>\n                          <Card bordered={false} hoverable={false}>\n                            <Card.Meta\n                              avatar={(\n                                <Avatar\n                                  src={\n                                    request.user?.avatar\n                                    || '/default-user-icon.png'\n                                  }\n                                />\n                              )}\n                              title={(\n                                <>\n                                  <span>{request.user?.username}</span>\n                                  {' '}\n                                  (\n                                  <NumberFormat\n                                    value={request.user?.balance || 0}\n                                    suffix=\" tokens\"\n                                  />\n                                  )\n                                </>\n                              )}\n                              description={formatDate(request?.createdAt)}\n                            />\n                          </Card>\n                        </a>\n                      </Link>\n                    </Menu.Item>\n                  ))\n                ) : (\n                  <Menu.Item>There are no private request.</Menu.Item>\n                )}\n              </Menu>\n            )}\n          >\n            <span className=\"call-requests\">\n              <Badge count={privateRequests.length} showZero>\n                <BellOutlined style={{ color: '#ffffff' }} />\n              </Badge>\n            </span>\n          </Dropdown>\n        )}\n        <Dropdown\n          overlay={(\n            <Menu key=\"menu-right-content\">\n              {currentUser.role === 'user' && [\n                <Menu.Item\n                  key=\"settings-menu-right-content\"\n                  onClick={() => Router.push('/account/user/account-settings')}\n                >\n                  <span>\n                    <SettingOutlined className=\"primary-icon\" />\n                    {' '}\n                    Profile\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"favorite-menu-right-content\"\n                  onClick={() => Router.push('/account/user/favorites')}\n                >\n                  <span>\n                    <HeartOutlined className=\"primary-icon\" />\n                    {' '}\n                    My Favorites\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"funds-tokens-menu-right-content\"\n                  onClick={() => Router.push('/account/user/funds-tokens')}\n                >\n                  <span>\n                    <span className=\"anticon primary-icon\">\n                      <FundsIcon />\n                    </span>\n                    {' '}\n                    Funds / Tokens\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"user-messages-menu-right-content\"\n                  onClick={() => Router.push('/messages')}\n                >\n                  <span>\n                    <MessageOutlined className=\"primary-icon\" />\n                    {' '}\n                    Messages (\n                    {totalNotReadMessage || 0}\n                    )\n                  </span>\n                </Menu.Item>\n              ]}\n\n              {currentUser.role === 'performer' && [\n                <Menu.Item\n                  key=\"profile-menu-right-content\"\n                  onClick={() => Router.push('/account/performer/profile')}\n                >\n                  <span>\n                    <UserOutlined className=\"primary-icon\" />\n                    {' '}\n                    Profile\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"account-settings-menu-right-content\"\n                  onClick={() => Router.push('/account/performer/account-settings')}\n                >\n                  <span>\n                    <SettingOutlined className=\"primary-icon\" />\n                    {' '}\n                    Account\n                    Settings\n                  </span>\n                </Menu.Item>,\n                <Menu.Item\n                  key=\"model-messages-menu-right-content\"\n                  onClick={() => Router.push('/messages')}\n                >\n                  <span>\n                    <MessageOutlined className=\"primary-icon\" />\n                    {' '}\n                    Messages (\n                    {totalNotReadMessage}\n                    )\n                  </span>\n                </Menu.Item>\n              ]}\n              {currentUser.role === 'studio' && [\n                <Menu.Item\n                  key=\"account-settings-menu-right-content\"\n                  onClick={() => Router.push('/studio/account-settings')}\n                >\n                  <span>\n                    <SettingOutlined className=\"primary-icon\" />\n                    {' '}\n                    Account\n                    Settings\n                  </span>\n                </Menu.Item>\n              ]}\n              <Menu.Item key=\"log-out\" onClick={this.beforeLogout.bind(this)}>\n                <LogoutOutlined className=\"primary-icon\" />\n                {' '}\n                Log out\n              </Menu.Item>\n            </Menu>\n          )}\n        >\n          <Avatar\n            style={{\n              margin: '0 15px',\n              cursor: 'pointer',\n              background: '#ffffff'\n            }}\n            src={currentUser?.avatar || '/default-user-icon.png'}\n          />\n        </Dropdown>\n      </>\n    ) : (\n      <Button style={{ marginLeft: 20, marginRight: 10, color: '#ff0066' }}>\n        <Link href=\"/auth/login/user\" as=\"/auth/login\">\n          <a>Login</a>\n        </Link>\n      </Button>\n    );\n\n    return (\n      <Layout.Header className=\"header\" id=\"layoutHeader\">\n        <SoundPlayer ref={(ref) => (this.soundRef = ref)} soundUrl={tipSound} />\n        <div className=\"left-container\">\n          <Link href=\"/cams\" shallow as=\"/\">\n            <a className=\"header-logo\">\n              <img\n                src={\n                  typeof ui.logo === 'string' && ui.logo.length > 0\n                    ? ui.logo\n                    : '/xcam-logo-white.png'\n                }\n                alt=\"header-logo\"\n              />\n            </a>\n          </Link>\n          <LeftHeaderContent {...this.props} current={currentUser} />\n        </div>\n        <div className=\"right-container\">\n          <div\n            className={showSearch ? 'search-icon active' : 'search-icon'}\n            aria-hidden\n            onClick={() => this.setState({ showSearch: !showSearch })}\n          >\n            {showSearch ? <CloseOutlined /> : <SearchOutlined />}\n          </div>\n          <div className={!showSearch ? 'hide search-bar' : 'search-bar'}>\n            <Input.Search\n              placeholder=\"Enter keyword\"\n              loading={false}\n              allowClear\n              enterButton\n              onPressEnter={this.onPressEnter.bind(this)}\n              onSearch={this.onSearchPerformer.bind(this)}\n            />\n          </div>\n          {rightContent}\n        </div>\n      </Layout.Header>\n    );\n  }\n}\n\nHeader.contextType = SocketContext;\n\nconst userSelecter = (state) => state.user.current;\nconst performerSelecter = (state) => state.performer.current;\nconst studioSelecter = (state) => state.studio.current;\nconst authSelecter = (state) => state.auth;\n\nconst currentUserSelecter = createSelector(\n  userSelecter,\n  performerSelecter,\n  studioSelecter,\n  authSelecter,\n  (user, performer, studio, auth) => {\n    if (!auth.loggedIn) return {};\n\n    if (user?._id) {\n      return { ...user, role: 'user' };\n    }\n\n    if (performer?._id) {\n      return { ...performer, role: 'performer' };\n    }\n\n    if (studio?._id) {\n      return { ...studio, role: 'studio' };\n    }\n\n    return {};\n  }\n);\n\nHeader.contextType = SocketContext;\n\nconst mapStateToProps = (state: any) => ({\n  ui: { ...state.ui },\n  currentUser: currentUserSelecter(state),\n  tipSound: state.settings.tipSound,\n  loggedIn: state.auth.loggedIn,\n  performerCategories: state.performer.categories,\n  totalNotReadMessage: state.message.totalNotReadMessage,\n  ...state.streaming\n});\nconst mapDispatch = {\n  logout,\n  getPerformerCategories,\n  getCountries,\n  addPrivateRequest,\n  getStudioStats,\n  countNotReadMessage\n};\nexport default connect(mapStateToProps, mapDispatch)(withRouter(Header));\n"]},"metadata":{},"sourceType":"module"}